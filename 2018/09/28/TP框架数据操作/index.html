<!DOCTYPE html>
<html>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="计划把TP框架的基础部分看一看以帮助审计,就先以3.2.x的手册练习,持续更新……   连贯操作:  public function testsql(){     $User = M(&amp;quot;User&amp;quot;); // 实例化User对象      $result = $Model-&amp;gt;select();     //SELECT * FROM `user`      //1.whe">
<meta name="keywords" content="基础知识">
<meta property="og:type" content="article">
<meta property="og:title" content="基础知识 | TP框架数据操作">
<meta property="og:url" content="http://yoursite.com/2018/09/28/TP框架数据操作/index.html">
<meta property="og:site_name" content="P0rZ9&#39;s blog">
<meta property="og:description" content="计划把TP框架的基础部分看一看以帮助审计,就先以3.2.x的手册练习,持续更新……   连贯操作:  public function testsql(){     $User = M(&amp;quot;User&amp;quot;); // 实例化User对象      $result = $Model-&amp;gt;select();     //SELECT * FROM `user`      //1.whe">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2018-10-15T14:49:14.871Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="基础知识 | TP框架数据操作">
<meta name="twitter:description" content="计划把TP框架的基础部分看一看以帮助审计,就先以3.2.x的手册练习,持续更新……   连贯操作:  public function testsql(){     $User = M(&amp;quot;User&amp;quot;); // 实例化User对象      $result = $Model-&amp;gt;select();     //SELECT * FROM `user`      //1.whe">
    
    
        
          
              <link rel="shortcut icon" href="../../../../images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="../../../../images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="../../../../images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>基础知识 | TP框架数据操作</title>
    <!-- styles -->
    <link rel="stylesheet" href="../../../../css/style.css">
    <!-- rss -->
    
    
</head>

<body>
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <li><a href="../../../../index.html">Home</a></li><li><a href="../../../../about.html">About</a></li><li><a href="../../../../archives/">Writing</a></li><li><a href="../../../../friends.html">Friends</a></li>
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="../../29/Thinkphp3.2 find_delete_selete注入分析/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="../../27/代码审计Day4 - strpos使用不当引发漏洞/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">上一篇</span>
      <span id="i-next" class="info" style="display:none;">下一篇</span>
      <span id="i-top" class="info" style="display:none;">回到顶部</span>
      <span id="i-share" class="info" style="display:none;">分享</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://yoursite.com/2018/09/28/TP框架数据操作/"><i class="fa fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://yoursite.com/2018/09/28/TP框架数据操作/&text=基础知识 | TP框架数据操作"><i class="fa fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://yoursite.com/2018/09/28/TP框架数据操作/&title=基础知识 | TP框架数据操作"><i class="fa fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://yoursite.com/2018/09/28/TP框架数据操作/&is_video=false&description=基础知识 | TP框架数据操作"><i class="fa fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=基础知识 | TP框架数据操作&body=Check out this article: http://yoursite.com/2018/09/28/TP框架数据操作/"><i class="fa fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://yoursite.com/2018/09/28/TP框架数据操作/&title=基础知识 | TP框架数据操作"><i class="fa fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://yoursite.com/2018/09/28/TP框架数据操作/&title=基础知识 | TP框架数据操作"><i class="fa fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://yoursite.com/2018/09/28/TP框架数据操作/&title=基础知识 | TP框架数据操作"><i class="fa fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://yoursite.com/2018/09/28/TP框架数据操作/&title=基础知识 | TP框架数据操作"><i class="fa fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://yoursite.com/2018/09/28/TP框架数据操作/&name=基础知识 | TP框架数据操作&description="><i class="fa fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      
    </div>
  </span>
</div>

    
    <div class="content index width mx-auto px2 my4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        基础知识 | TP框架数据操作
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">P0rZ9's blog</span>
      </span>
      
    <div class="postdate">
        <time datetime="2018-09-28T00:15:41.000Z" itemprop="datePublished">2018-09-28</time>
    </div>


      
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="../../../../tags/基础知识/">基础知识</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <blockquote>
<p>计划把TP框架的基础部分看一看以帮助审计,就先以3.2.x的手册练习,持续更新……</p>
</blockquote>
<hr>
<p>连贯操作:</p>
<pre><code> public function testsql(){
    $User = M(&quot;User&quot;); // 实例化User对象

    $result = $Model-&gt;select();
    //SELECT * FROM `user`

    //1.where：完成多种查询操作
    //字符串查询
    $User-&gt;where(&apos;type=1 AND status=1&apos;)-&gt;select();
    //执行的sql语句为:select * from User where type=1 and status=1;

    //数组查询
    $map[&apos;id&apos;] = 1;
    $map[&apos;name&apos;] = &apos;test&apos;;
    $user-&gt;where($map)-&gt;select();
    //sql语句:select * from where id=1 and &apos;name&apos; = &apos;test&apos;;

    //表达式查询   sql注入出现多的地方
    $map[&apos;name&apos;] = array(&apos;eq&apos;,&quot;1&quot;);//其他表达式:GT EGT LT ELT LIKE BETWEEN IN EXP
    $user-&gt;where($map)-&gt;select();
    echo M(&apos;user&apos;)-&gt;_SQL();//SELECT * FROM `user` WHERE `name` = &apos;1&apos;


    //2.table：主要用于指定操作的数据表
    $Model-&gt;table(&apos;gather&apos;)-&gt;where(&apos;id=1&apos;)-&gt;select();
    //SELECT * FROM `gather` WHERE ( id=1 ) 由user表暂时切换到gather表


    //3.order:用于对操作的结果排序
    $Model-&gt;order(&apos;id desc&apos;)-&gt;limit(5)-&gt;select();
    //SELECT * FROM `user` ORDER BY id desc LIMIT 5
    $Model-&gt;order(&apos;name desc,id&apos;)-&gt;limit(5)-&gt;select();
    //支持多个字段排序 如果没有指定desc或者asc排序规则的话，默认为asc。


    //4.field 标识要返回或者操作的字段，可以用于查询和写入操作
    //查询：
    $result = $Model-&gt;field(&apos;id,name&apos;)-&gt;select();
    //SELECT `id`,`name` FROM `user

    $result = $Model-&gt;field(&apos;id,SUM(id)&apos;)-&gt;select();
    //可执行函数 user() database()等

    $Model-&gt;field(&apos;pwd&apos;,true)-&gt;select();
    //排除pwd这个字段  sql:SELECT `Id`,`name` FROM `user`

    //写入：
    $Model-&gt;field(&apos;id,name,pwd&apos;)-&gt;create();
    //也可以字段合法性检测 合法字段只有id name pwd这三种


    //5.union 联合查询 必须保证字段数量一样  每个union方法相当于一个独立的SELECT语句
    $Model-&gt;field(&apos;id&apos;)-&gt;table(&apos;gather&apos;)-&gt;union(array(&apos;field&apos; =&gt; &apos;pwd&apos;,&apos;table&apos; =&gt; &apos;user&apos;))-&gt;union(array(&apos;field&apos;=&gt;&apos;goods_name&apos;,&apos;table&apos;=&gt;&apos;goods&apos;))-&gt;select();



    //6.cache  
    $result = $Model-&gt;cache(&apos;key&apos;,60)-&gt;find();
    //find返回一条数据 缓存有效期为60s
}
</code></pre><p>CURD操作:</p>
<pre><code>public function test_CURD(){
    $Model = M(&apos;user&apos;);
//CURD操作
//1.数据创建 只是保存在内存中 只有用add或save才会写入数据库中
$data[&apos;name&apos;] = &apos;p0rz9&apos;;
    $data[&apos;pwd&apos;] = &apos;123456&apos;;
$Model-&gt;create($data);
var_dump($Model-&gt;name);//直接读取数据
    $Model-&gt;name = &apos;P0rz9&apos;;//直接修改数据


    //2.数据写入 
    $Model-&gt;add();
    //sql:INSERT INTO `user` (`name`,`pwd`) VALUES (&apos;P0rz9&apos;,&apos;123456&apos;) 

    //字段过滤 写入时可用field过滤非法字段
    $Model-&gt;field(&apos;name&apos;)-&gt;data($data)-&gt;add();
    //最终只有name字段的数据写入 pwd字段被过滤

    //字段内容过滤 filter方法对其内容过滤 strip_tags为过滤函数
    $Model-&gt;data($data)-&gt;filter(&apos;strip_tags&apos;)-&gt;add();

    //3.数据读取
    $result = $Model-&gt;where(&apos;id=1&apos;)-&gt;find();//返回一行数据(或关联数据)
    var_dump($result);//也可用data()获取查询后的数据:var_dump($Model-&gt;data());



    //4.更新数据
    $data[&apos;name&apos;] = &apos;kkk&apos;;
    $Model-&gt;where(&apos;Id=1&apos;)-&gt;save($data);//数据对象属性操作
    $Model-&gt;name = &apos;ThinkPHP&apos;;
    $Model-&gt;where(&apos;id=1&apos;)-&gt;save();//对象方式操作


    //5.删除数据
    $Model-&gt;where(&apos;Id=5&apos;)-&gt;delete(); // 删除id为5的用户数据
    $Model-&gt;delete(&apos;1,2,5&apos;); // 删除主键为1,2和5的用户数据
    $Model-&gt;where(&apos;status=0&apos;)-&gt;delete(); // 删除所有状态为0的用户数据
    $Model-&gt;where(&apos;status=0&apos;)-&gt;order(&apos;create_time&apos;)-&gt;limit(&apos;5&apos;)-&gt;delete(); 
    //删除所有状态为0的5个用户数据 按照创建时间排序
</code></pre><p>}</p>
<p>TP自带的核心函数:</p>
<pre><code>public function Test_Think_Func(){

    $User = D(&apos;User&apos;);// 相当于 $User = new \Home\Model\UserModel();
    $User-&gt;select(); //执行具体的数据操作

    $User = M(&apos;User&apos;);// 和用法 $User = new \Think\Model(&apos;User&apos;);等效
    $User-&gt;select();

}
</code></pre>
  </div>
</article>



    </div>
    
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="../../../../index.html">Home</a></li>
         
          <li><a href="../../../../about.html">About</a></li>
         
          <li><a href="../../../../archives/">Writing</a></li>
         
          <li><a href="../../../../friends.html">Friends</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://yoursite.com/2018/09/28/TP框架数据操作/"><i class="fa fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://yoursite.com/2018/09/28/TP框架数据操作/&text=基础知识 | TP框架数据操作"><i class="fa fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://yoursite.com/2018/09/28/TP框架数据操作/&title=基础知识 | TP框架数据操作"><i class="fa fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://yoursite.com/2018/09/28/TP框架数据操作/&is_video=false&description=基础知识 | TP框架数据操作"><i class="fa fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=基础知识 | TP框架数据操作&body=Check out this article: http://yoursite.com/2018/09/28/TP框架数据操作/"><i class="fa fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://yoursite.com/2018/09/28/TP框架数据操作/&title=基础知识 | TP框架数据操作"><i class="fa fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://yoursite.com/2018/09/28/TP框架数据操作/&title=基础知识 | TP框架数据操作"><i class="fa fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://yoursite.com/2018/09/28/TP框架数据操作/&title=基础知识 | TP框架数据操作"><i class="fa fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://yoursite.com/2018/09/28/TP框架数据操作/&title=基础知识 | TP框架数据操作"><i class="fa fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://yoursite.com/2018/09/28/TP框架数据操作/&name=基础知识 | TP框架数据操作&description="><i class="fa fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
      <ul>
        <li id="toc"><a class="icon" href="#" onclick='$("#toc-footer").toggle();return false;'><i class="fa fa-list fa-lg" aria-hidden="true"></i> 目录</a></li>
        <li id="share"><a class="icon" href="#" onclick='$("#share-footer").toggle();return false;'><i class="fa fa-share-alt fa-lg" aria-hidden="true"></i> 分享</a></li>
        <li id="top" style="display:none"><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up fa-lg" aria-hidden="true"></i> 顶部</a></li>
        <li id="menu"><a class="icon" href="#" onclick='$("#nav-footer").toggle();return false;'><i class="fa fa-bars fa-lg" aria-hidden="true"></i> 菜单</a></li>
      </ul>
    </div>

  </div>
</div>

    
    <footer id="footer">
  <div class="footer-left">
    版权所有 &copy; 2019 P0rZ9
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <li><a href="../../../../index.html">Home</a></li><li><a href="../../../../about.html">About</a></li><li><a href="../../../../archives/">Writing</a></li><li><a href="../../../../friends.html">Friends</a></li>
      </ul>
    </nav>
  </div>
</footer>

</body>
</html>
<!-- styles -->
<link rel="stylesheet" href="../../../../lib/font-awesome/css/font-awesome.min.css">
<link rel="stylesheet" href="../../../../lib/meslo-LG/styles.css">
<link rel="stylesheet" href="../../../../lib/justified-gallery/justifiedGallery.min.css">


<!-- jquery -->
<script src="../../../../lib/jquery/jquery.min.js"></script>
<script src="../../../../lib/justified-gallery/jquery.justifiedGallery.min.js"></script>
<script src="../../../../js/main.js"></script>
<!-- Google Analytics -->

    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-86660611-1', 'auto');
        ga('send', 'pageview');
    </script>

<!-- Disqus Comments -->


